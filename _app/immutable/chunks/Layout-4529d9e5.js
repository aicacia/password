import{S as Et,i as Tt,Q as At,e as lt,c as ht,a as at,d as ot,b as nt,g as pt,E as ft,v as Ut,k as gt,t as Dt,m as yt,h as Ft,R as mt,M as ut,T as Lt,N as _t,O as bt,j as Bt,$ as qt,_ as Jt,a0 as Gt,I as Ht,w as Rt,x as St,y as kt,J as Yt,K as Vt,L as zt,q as wt,o as Pt,B as Ot}from"./index-af903a83.js";import{_ as $t,w as Kt}from"./preload-helper-b1a2c58b.js";const Wt="v21wdidfxjapm8b",Xt="399181883347-3dfijgbemptplmueu01bsfga9jpkks6j.apps.googleusercontent.com";var Qt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Zt(Z){return Z&&Z.__esModule&&Object.prototype.hasOwnProperty.call(Z,"default")?Z.default:Z}var xt={exports:{}};/*! remotestorage.js 2.0.0-beta.3, https://remotestorage.io, MIT licensed */(function(Z,V){(function(F,D){Z.exports=D()})(Qt,function(){return function(F){var D={};function E(l){if(D[l])return D[l].exports;var m=D[l]={i:l,l:!1,exports:{}};return F[l].call(m.exports,m,m.exports,E),m.l=!0,m.exports}return E.m=F,E.c=D,E.d=function(l,m,g){E.o(l,m)||Object.defineProperty(l,m,{enumerable:!0,get:g})},E.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},E.t=function(l,m){if(1&m&&(l=E(l)),8&m||4&m&&typeof l=="object"&&l&&l.__esModule)return l;var g=Object.create(null);if(E.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:l}),2&m&&typeof l!="string")for(var w in l)E.d(g,w,function(R){return l[R]}.bind(null,w));return g},E.n=function(l){var m=l&&l.__esModule?function(){return l.default}:function(){return l};return E.d(m,"a",m),m},E.o=function(l,m){return Object.prototype.hasOwnProperty.call(l,m)},E.p="",E(E.s=17)}([function(F,D,E){(function(l,m){Object.defineProperty(D,"__esModule",{value:!0}),D.applyMixins=D.toBase64=D.getTextFromArrayBuffer=D.shouldBeTreatedAsBinary=D.getJSONFromLocalStorage=D.localStorageAvailable=D.pathsFromRoot=D.deepClone=D.equal=D.bindAll=D.cleanPath=D.baseName=D.isDocument=D.isFolder=D.containingFolder=D.extend=D.getGlobalContext=D.globalContext=D.logError=void 0,D.logError=g=>{typeof g=="string"?console.error(g):console.error(g.message,g.stack)},D.globalContext=typeof window!="undefined"?window:typeof self=="object"?self:l,D.getGlobalContext=()=>typeof window!="undefined"?window:typeof self=="object"?self:l,D.extend=(...g)=>{const w=g[0];return Array.prototype.slice.call(g,1).forEach(function(R){for(const b in R)w[b]=R[b]}),w},D.containingFolder=g=>{if(g==="")return"/";if(!g)throw"Path not given!";return g.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")},D.isFolder=g=>g.substr(-1)==="/",D.isDocument=g=>!D.isFolder(g),D.baseName=g=>{const w=g.split("/");return D.isFolder(g)?w[w.length-2]+"/":w[w.length-1]},D.cleanPath=g=>g.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/").replace(/'/g,"%27"),D.bindAll=g=>{for(const w in this)typeof g[w]=="function"&&(g[w]=g[w].bind(g))},D.equal=(g,w,R=[])=>{let b;if(typeof g!=typeof w)return!1;if(typeof g=="number"||typeof g=="boolean"||typeof g=="string")return g===w;if(typeof g=="function")return g.toString()===w.toString();if(g instanceof ArrayBuffer&&w instanceof ArrayBuffer&&(g=new Uint8Array(g),w=new Uint8Array(w)),g instanceof Array){if(g.length!==w.length)return!1;for(let u=0,A=g.length;u<A;u++)if(!D.equal(g[u],w[u],R))return!1}else{for(b in g)if(g.hasOwnProperty(b)&&!(b in w))return!1;for(b in w){if(!w.hasOwnProperty(b))continue;if(!(b in g))return!1;let u;if(typeof w[b]=="object"){if(R.indexOf(w[b])>=0)continue;u=R.slice(),u.push(w[b])}if(!D.equal(g[b],w[b],u))return!1}}return!0},D.deepClone=g=>{if(g!==void 0){const w=JSON.parse(JSON.stringify(g));return function R(b,u){if(typeof b=="object"&&!Array.isArray(b)&&b!==null){for(const A in b)if(typeof b[A]=="object"&&b[A]!==null)if(b[A].toString()==="[object ArrayBuffer]"){u[A]=new ArrayBuffer(b[A].byteLength);const y=new Int8Array(b[A]);new Int8Array(u[A]).set(y)}else R(b[A],u[A])}}(g,w),w}},D.pathsFromRoot=g=>{const w=[g],R=g.replace(/\/$/,"").split("/");for(;R.length>1;)R.pop(),w.push(R.join("/")+"/");return w},D.localStorageAvailable=()=>{const g=D.getGlobalContext();if(!("localStorage"in g))return!1;try{return g.localStorage.setItem("rs-check","1"),g.localStorage.removeItem("rs-check"),!0}catch{return!1}},D.getJSONFromLocalStorage=g=>{const w=D.getGlobalContext();try{return JSON.parse(w.localStorage.getItem(g))}catch{}},D.shouldBeTreatedAsBinary=(g,w)=>!!(w&&w.match(/charset=binary/)||/[\x00-\x08\x0E-\x1F\uFFFD]/.test(g)),D.getTextFromArrayBuffer=(g,w)=>new Promise(R=>{if(typeof Blob=="undefined"){const b=new m(new Uint8Array(g));R(b.toString(w))}else{let b;const u=D.globalContext;if(u.BlobBuilder=u.BlobBuilder||u.WebKitBlobBuilder,u.BlobBuilder!==void 0){const y=new u.BlobBuilder;y.append(g),b=y.getBlob()}else b=new Blob([g]);const A=new FileReader;typeof A.addEventListener=="function"?A.addEventListener("loadend",function(y){R(y.target.result)}):A.onloadend=function(y){R(y.target.result)},A.readAsText(b,w)}}),D.toBase64=g=>{const w=D.getGlobalContext();return"btoa"in w?w.btoa(g):m.from(g).toString("base64")},D.applyMixins=function(g,w){w.forEach(R=>{Object.getOwnPropertyNames(R.prototype).forEach(b=>{Object.defineProperty(g.prototype,b,Object.getOwnPropertyDescriptor(R.prototype,b))})})}}).call(this,E(5),E(19).Buffer)},function(F,D,E){const l=(this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}})(E(3));F.exports=function(...m){l.default.logging&&console.log(...m)}},function(F,D,E){const l=(this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}})(E(1));F.exports=class{addEvents(m){m.forEach(g=>this._addEvent(g))}addEventListener(m,g){if(typeof m!="string")throw new Error("Argument eventName should be a string");if(typeof g!="function")throw new Error("Argument handler should be a function");l.default("[EventHandling] Adding event listener",m),this._validateEvent(m),this._handlers[m].push(g)}on(m,g){return this.addEventListener(m,g)}removeEventListener(m,g){this._validateEvent(m);const w=this._handlers[m].length;for(let R=0;R<w;R++)if(this._handlers[m][R]===g)return void this._handlers[m].splice(R,1)}_emit(m,...g){this._validateEvent(m),this._handlers[m].slice().forEach(w=>{w.apply(this,g)})}_validateEvent(m){if(!(m in this._handlers))throw new Error("Unknown event: "+m)}_delegateEvent(m,g){g.on(m,w=>{this._emit(m,w)})}_addEvent(m){this._handlers===void 0&&(this._handlers={}),this._handlers[m]=[]}}},function(F,D,E){const l={cache:!0,changeEvents:{local:!0,window:!1,remote:!0,conflict:!0},cordovaRedirectUri:void 0,logging:!1,modules:[],backgroundSyncInterval:6e4,disableFeatures:[],discoveryTimeout:1e4,isBackground:!1,requestTimeout:3e4,syncInterval:1e4};F.exports=l},function(F,D,E){class l extends Error{constructor(g,w={}){super(),this.name="Unauthorized",this.message=g===void 0?"App authorization expired or revoked.":g,w.code!==void 0&&(this.code=w.code),this.stack=new Error().stack}}F.exports=l},function(F,D){var E;E=function(){return this}();try{E=E||new Function("return this")()}catch{typeof window=="object"&&(E=window)}F.exports=E},function(F,D,E){var l=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};const m=l(E(1)),g=E(0),w=l(E(4));let R;function b(A){const y=A||u.getLocation().href,f=y.indexOf("#");if(f===-1)return;const c=y.substring(f+1);return c.includes("=")?c.split("&").reduce(function(p,h){const C=h.split("=");if(C[0]==="state"&&C[1].match(/rsDiscovery/)){let k=decodeURIComponent(C[1]);const L=k.substr(k.indexOf("rsDiscovery=")).split("&")[0].split("=")[1];p.rsDiscovery=JSON.parse(atob(L)),k=k.replace(new RegExp("&?rsDiscovery="+L),""),k.length>0&&(p.state=k)}else p[decodeURIComponent(C[0])]=decodeURIComponent(C[1]);return p},{}):void 0}class u{static authorize(y,{authURL:f,scope:c,redirectUri:p,clientId:h}){if(m.default("[Authorize] authURL = ",f,"scope = ",c,"redirectUri = ",p,"clientId = ",h),!g.localStorageAvailable()&&y.backend==="remotestorage"){p+=p.indexOf("#")>0?"&":"#";const k={userAddress:y.remote.userAddress,href:y.remote.href,storageApi:y.remote.storageApi,properties:y.remote.properties};p+="rsDiscovery="+g.toBase64(JSON.stringify(k))}const C=function(k,L,O,e){const s=L.indexOf("#");let i=k;return i+=k.indexOf("?")>0?"&":"?",i+="redirect_uri="+encodeURIComponent(L.replace(/#.*$/,"")),i+="&scope="+encodeURIComponent(O),i+="&client_id="+encodeURIComponent(e),s!==-1&&s+1!==L.length&&(i+="&state="+encodeURIComponent(L.substring(s+1))),i+="&response_type=token",i}(f,p,c,h);g.globalContext.cordova?u.openWindow(C,p,"location=yes,clearsessioncache=yes,clearcache=yes").then(k=>{y.remote.configure({token:k.access_token})}):u.setLocation(C)}static setLocation(y){if(typeof y=="string")document.location.href=y;else{if(typeof y!="object")throw"Invalid location "+y;document.location=y}}static _rs_supported(){return typeof document!="undefined"}static _rs_cleanup(y){y.removeEventListener("features-loaded",R)}}u.IMPLIED_FAKE_TOKEN=!1,u.getLocation=function(){return document.location},u.openWindow=function(A,y,f){return new Promise((c,p)=>{const h=open(A,"_blank",f);if(!h||h.closed)return p("Authorization popup was blocked");function C(){return p("Authorization was canceled")}h.addEventListener("loadstart",function(k){if(k.url.indexOf(y)!==0)return;h.removeEventListener("exit",C),h.close();const L=b(k.url);return L?c(L):p("Authorization error")}),h.addEventListener("exit",C)})},u._rs_init=function(A){const y=b();let f;y&&(f=u.getLocation(),f.hash=""),R=function(){let c=!1;if(y){if(y.error)throw y.error==="access_denied"?new w.default("Authorization failed: access denied",{code:"access_denied"}):new w.default("Authorization failed: "+y.error);y.rsDiscovery&&A.remote.configure(y.rsDiscovery),y.access_token&&(A.remote.configure({token:y.access_token}),c=!0),y.remotestorage&&(A.connect(y.remotestorage),c=!0),y.state&&(f=u.getLocation(),u.setLocation(f.href.split("#")[0]+"#"+y.state)),c||A.remote.stopWaitingForToken()}else A.remote.stopWaitingForToken()},A.on("features-loaded",R)},F.exports=u},function(F,D,E){var l=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};const m=l(E(23)),g=l(E(24)),w=l(E(25)),R=l(E(2)),b=l(E(3)),u=E(0);class A{constructor(f,c){if(this.schemas={configurable:!0,get:function(){return A.Types.inScope(this.moduleName)}},c[c.length-1]!=="/")throw"Not a folder: "+c;c==="/"&&(this.makePath=h=>(h[0]==="/"?"":"/")+h),this.storage=f,this.base=c;const p=this.base.split("/");p.length>2?this.moduleName=p[1]:this.moduleName="root",this.addEvents(["change"]),this.on=this.on.bind(this),f.onChange(this.base,this._fireChange.bind(this))}scope(f){return new A(this.storage,this.makePath(f))}getListing(f,c){if(typeof f!="string")f="";else if(f.length>0&&f[f.length-1]!=="/")return Promise.reject("Not a folder: "+f);return this.storage.get(this.makePath(f),c).then(function(p){return p.statusCode===404?{}:p.body})}getAll(f,c){if(typeof f!="string")f="";else if(f.length>0&&f[f.length-1]!=="/")return Promise.reject("Not a folder: "+f);return this.storage.get(this.makePath(f),c).then(p=>{if(p.statusCode===404)return{};if(typeof p.body=="object"){const h=Object.keys(p.body);if(h.length===0)return{};const C=h.map(k=>this.storage.get(this.makePath(f+k),c).then(function(L){if(typeof L.body=="string")try{L.body=JSON.parse(L.body)}catch{}typeof L.body=="object"&&(p.body[k]=L.body)}));return Promise.all(C).then(function(){return p.body})}})}getFile(f,c){return typeof f!="string"?Promise.reject("Argument 'path' of baseClient.getFile must be a string"):this.storage.get(this.makePath(f),c).then(function(p){return{data:p.body,contentType:p.contentType,revision:p.revision}})}storeFile(f,c,p){return typeof f!="string"?Promise.reject("Argument 'mimeType' of baseClient.storeFile must be a string"):typeof c!="string"?Promise.reject("Argument 'path' of baseClient.storeFile must be a string"):typeof p!="string"&&typeof p!="object"?Promise.reject("Argument 'body' of baseClient.storeFile must be a string, ArrayBuffer, or ArrayBufferView"):(this.storage.access.checkPathPermission(this.makePath(c),"rw")||console.warn("WARNING: Editing a document to which only read access ('r') was claimed"),this.storage.put(this.makePath(c),p,f).then(h=>h.statusCode===200||h.statusCode===201?h.revision:Promise.reject("Request (PUT "+this.makePath(c)+") failed with status: "+h.statusCode)))}getObject(f,c){return typeof f!="string"?Promise.reject("Argument 'path' of baseClient.getObject must be a string"):this.storage.get(this.makePath(f),c).then(p=>{if(typeof p.body=="object")return p.body;if(typeof p.body=="string")try{return JSON.parse(p.body)}catch{throw new Error("Not valid JSON: "+this.makePath(f))}else if(p.body!==void 0&&p.statusCode===200)return Promise.reject("Not an object: "+this.makePath(f))})}storeObject(f,c,p){if(typeof f!="string")return Promise.reject("Argument 'typeAlias' of baseClient.storeObject must be a string");if(typeof c!="string")return Promise.reject("Argument 'path' of baseClient.storeObject must be a string");if(typeof p!="object")return Promise.reject("Argument 'object' of baseClient.storeObject must be an object");this._attachType(p,f);try{const h=this.validate(p);if(!h.valid)return Promise.reject(h)}catch(h){return Promise.reject(h)}return this.storage.put(this.makePath(c),JSON.stringify(p),"application/json; charset=UTF-8").then(h=>h.statusCode===200||h.statusCode===201?h.revision:Promise.reject("Request (PUT "+this.makePath(c)+") failed with status: "+h.statusCode))}remove(f){return typeof f!="string"?Promise.reject("Argument 'path' of baseClient.remove must be a string"):(this.storage.access.checkPathPermission(this.makePath(f),"rw")||console.warn("WARNING: Removing a document to which only read access ('r') was claimed"),this.storage.delete(this.makePath(f)))}getItemURL(f){if(typeof f!="string")throw"Argument 'path' of baseClient.getItemURL must be a string";return this.storage.connected?(f=u.cleanPath(this.makePath(f)),this.storage.remote.href+f):void 0}cache(f,c="ALL"){if(typeof f!="string")throw"Argument 'path' of baseClient.cache must be a string";if(typeof c!="string")throw"Argument 'strategy' of baseClient.cache must be a string or undefined";if(c!=="FLUSH"&&c!=="SEEN"&&c!=="ALL")throw`Argument 'strategy' of baseclient.cache must be one of ["FLUSH", "SEEN", "ALL"]`;return this.storage.caching.set(this.makePath(f),c),this}flush(f){return this.storage.local.flush(f)}declareType(f,c,p){let h;p?h=c:(p=c,h=this._defaultTypeURI(f)),A.Types.declare(this.moduleName,f,h,p)}validate(f){const c=A.Types.getSchema(f["@context"]);if(c)return m.default.validateResult(f,c);throw new w.default(f["@context"])}_defaultTypeURI(f){return"http://remotestorage.io/spec/modules/"+encodeURIComponent(this.moduleName)+"/"+encodeURIComponent(f)}_attachType(f,c){f["@context"]=A.Types.resolveAlias(this.moduleName+"/"+c)||this._defaultTypeURI(c)}makePath(f){return this.base+(f||"")}_fireChange(f){b.default.changeEvents[f.origin]&&(["new","old","lastCommon"].forEach(function(c){if((!f[c+"ContentType"]||/^application\/(.*)json(.*)/.exec(f[c+"ContentType"]))&&typeof f[c+"Value"]=="string")try{f[c+"Value"]=JSON.parse(f[c+"Value"])}catch{}}),this._emit("change",f))}static _rs_init(){}}A.Types=g.default,u.applyMixins(A,[R.default]),F.exports=A},function(F,D,E){(function(l){var m=this&&this.__awaiter||function(O,e,s,i){return new(s||(s=Promise))(function(_,d){function S(U){try{B(i.next(U))}catch(P){d(P)}}function q(U){try{B(i.throw(U))}catch(P){d(P)}}function B(U){var P;U.done?_(U.value):(P=U.value,P instanceof s?P:new s(function(N){N(P)})).then(S,q)}B((i=i.apply(O,e||[])).next())})},g=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};const w=g(E(6)),R=g(E(2)),b=g(E(4)),u=g(E(3)),A=g(E(1)),y=E(0);let f;const c="remotestorage:wireclient",p={"draft-dejong-remotestorage-00":2,"draft-dejong-remotestorage-01":3,"draft-dejong-remotestorage-02":4,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":1};let h;if(typeof(l||window).ArrayBufferView=="function")h=function(O){return O&&O instanceof(l||window).ArrayBufferView};else{const O=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];h=function(e){for(let s=0;s<8;s++)if(e instanceof O[s])return!0;return!1}}function C(O){return typeof O!="string"?O:O==="*"?"*":'"'+O+'"'}function k(O){return typeof O!="string"?O:O.replace(/^["']|["']$/g,"")}class L{constructor(e){if(this._revisionCache={},f=y.localStorageAvailable(),this.rs=e,this.connected=!1,this.addEvents(["connected","not-connected"]),f){const s=function(){const i=y.getJSONFromLocalStorage(c)||{},{userAddress:_,href:d,storageApi:S,token:q,properties:B}=i;return{userAddress:_,href:d,storageApi:S,token:q,properties:B}}();s&&setTimeout(()=>{this.configure(s)},0)}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}get storageType(){if(this.storageApi){const e=this.storageApi.match(/draft-dejong-(remotestorage-\d\d)/);return e?e[1]:"2012.04"}}_request(e,s,i,_,d,S,q){return m(this,void 0,void 0,function*(){if(function(U,P){return(U==="PUT"||U==="DELETE")&&y.isFolder(P)}(e,s))return Promise.reject(`Don't use ${e} on directories!`);let B;return i!==w.default.IMPLIED_FAKE_TOKEN&&(_.Authorization="Bearer "+i),this.rs._emit("wire-busy",{method:e,isFolder:y.isFolder(s)}),L.request(e,s,{body:d,headers:_,responseType:"arraybuffer"}).then(U=>{if(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:e,isFolder:y.isFolder(s),success:!0}),P=U.status,[401,403,404,412].indexOf(P)>=0)return A.default("[WireClient] Error response status",U.status),B=S?k(U.getResponseHeader("ETag")):void 0,U.status===401&&this.rs._emit("error",new b.default),Promise.resolve({statusCode:U.status,revision:B});if(function(N){return[201,204,304].indexOf(N)>=0}(U.status)||U.status===200&&e!=="GET")return B=k(U.getResponseHeader("ETag")),A.default("[WireClient] Successful request",B),Promise.resolve({statusCode:U.status,revision:B});{const N=U.getResponseHeader("Content-Type");B=S?k(U.getResponseHeader("ETag")):U.status===200?q:void 0;const r=function(o){let v,T="UTF-8";return o&&(v=o.match(/charset=(.+)$/),v&&(T=v[1])),T}(N);return y.shouldBeTreatedAsBinary(U.response,N)?(A.default("[WireClient] Successful request with unknown or binary mime-type",B),Promise.resolve({statusCode:U.status,body:U.response,contentType:N,revision:B})):y.getTextFromArrayBuffer(U.response,r).then(o=>(A.default("[WireClient] Successful request",B),Promise.resolve({statusCode:U.status,body:o,contentType:N,revision:B})))}var P},U=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:e,isFolder:y.isFolder(s),success:!1}),Promise.reject(U)))})}configure(e){if(typeof e!="object")throw new Error("WireClient configure settings parameter should be an object");if(e.userAddress!==void 0&&(this.userAddress=e.userAddress),e.href!==void 0&&(this.href=e.href),e.storageApi!==void 0&&(this.storageApi=e.storageApi),e.token!==void 0&&(this.token=e.token),e.properties!==void 0&&(this.properties=e.properties),typeof this.storageApi=="string"){const s=p[this.storageApi]||5;this.supportsRevs=s>=2}this.href&&this.token?(this.connected=!0,this.online=!0,this._emit("connected")):this.connected=!1,f&&(localStorage[c]=JSON.stringify({userAddress:this.userAddress,href:this.href,storageApi:this.storageApi,token:this.token,properties:this.properties}))}stopWaitingForToken(){this.connected||this._emit("not-connected")}get(e,s={}){if(!this.connected)return Promise.reject("not connected (path: "+e+")");const i={};return this.supportsRevs&&s.ifNoneMatch&&(i["If-None-Match"]=C(s.ifNoneMatch)),this._request("GET",this.href+y.cleanPath(e),this.token,i,void 0,this.supportsRevs,this._revisionCache[e]).then(_=>{if(!y.isFolder(e))return Promise.resolve(_);let d={};if(_.body!==void 0)try{_.body=JSON.parse(_.body)}catch{return Promise.reject("Folder description at "+this.href+y.cleanPath(e)+" is not JSON")}if(_.statusCode===200&&typeof _.body=="object"){if(Object.keys(_.body).length===0)_.statusCode=404;else if((S=_.body)["@context"]==="http://remotestorage.io/spec/folder-description"&&typeof S.items=="object"){for(const q in _.body.items)this._revisionCache[e+q]=_.body.items[q].ETag;d=_.body.items}else Object.keys(_.body).forEach(q=>{this._revisionCache[e+q]=_.body[q],d[q]={ETag:_.body[q]}});return _.body=d,Promise.resolve(_)}return Promise.resolve(_);var S})}put(e,s,i,_={}){if(!this.connected)return Promise.reject("not connected (path: "+e+")");!i.match(/charset=/)&&(s instanceof ArrayBuffer||h(s))&&(i+="; charset=binary");const d={"Content-Type":i};return this.supportsRevs&&(_.ifMatch&&(d["If-Match"]=C(_.ifMatch)),_.ifNoneMatch&&(d["If-None-Match"]=C(_.ifNoneMatch))),this._request("PUT",this.href+y.cleanPath(e),this.token,d,s,this.supportsRevs)}delete(e,s={}){if(!this.connected)throw new Error("not connected (path: "+e+")");s||(s={});const i={};return this.supportsRevs&&s.ifMatch&&(i["If-Match"]=C(s.ifMatch)),this._request("DELETE",this.href+y.cleanPath(e),this.token,i,void 0,this.supportsRevs)}static request(e,s,i){return m(this,void 0,void 0,function*(){return typeof fetch=="function"?L._fetchRequest(e,s,i):typeof XMLHttpRequest=="function"?L._xhrRequest(e,s,i):(A.default("[WireClient] You need to add a polyfill for fetch or XMLHttpRequest"),Promise.reject("[WireClient] You need to add a polyfill for fetch or XMLHttpRequest"))})}static _fetchRequest(e,s,i){let _;const d={};let S;typeof AbortController=="function"&&(S=new AbortController);const q=fetch(s,{method:e,headers:i.headers,body:i.body,signal:S?S.signal:void 0}).then(U=>{switch(A.default("[WireClient fetch]",U),U.headers.forEach((P,N)=>{d[N.toUpperCase()]=P}),_={readyState:4,status:U.status,statusText:U.statusText,response:void 0,getResponseHeader:P=>d[P.toUpperCase()]||null,responseType:i.responseType,responseURL:s},i.responseType){case"arraybuffer":return U.arrayBuffer();case"blob":return U.blob();case"json":return U.json();case void 0:case"":case"text":return U.text();default:throw new Error("responseType 'document' is not currently supported using fetch")}}).then(U=>(_.response=U,i.responseType&&i.responseType!=="text"||(_.responseText=U),_)),B=new Promise((U,P)=>{setTimeout(()=>{P("timeout"),S&&S.abort()},u.default.requestTimeout)});return Promise.race([q,B])}static _xhrRequest(e,s,i){return new Promise((_,d)=>{A.default("[WireClient]",e,s);let S=!1;const q=setTimeout(()=>{S=!0,d("timeout")},u.default.requestTimeout),B=new XMLHttpRequest;if(B.open(e,s,!0),i.responseType&&(B.responseType=i.responseType),i.headers)for(const P in i.headers)B.setRequestHeader(P,i.headers[P]);B.onload=()=>{S||(clearTimeout(q),_(B))},B.onerror=P=>{S||(clearTimeout(q),d(P))};let U=i.body;typeof U=="object"&&!h(U)&&U instanceof ArrayBuffer&&(U=new Uint8Array(U)),B.send(U)})}static _rs_init(e){e.remote=new L(e),e.remote.online=!0}static _rs_supported(){return typeof fetch=="function"||typeof XMLHttpRequest=="function"}static _rs_cleanup(){f&&delete localStorage[c]}}L.isArrayBufferView=h,y.applyMixins(L,[R.default]),F.exports=L}).call(this,E(5))},function(F,D,E){class l extends Error{constructor(g){super(),this.name="SyncError",this.message="Sync failed: ",typeof g=="string"?this.message+=g:(this.message+=g.message,this.stack=g.stack,this.originalError=g)}}F.exports=l},function(F,D,E){var l=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};const m=l(E(2)),g=l(E(3)),w=l(E(1)),R=E(0);class b{constructor(){this._updateNodesRunning=!1,this._updateNodesQueued=[]}get(p,h,C){return typeof h=="number"?this.getNodes(R.pathsFromRoot(p)).then(k=>{const L=u(k[p]);return A(k,h)?C(p):L?{statusCode:200,body:L.body||L.itemsMap,contentType:L.contentType}:{statusCode:404}}):this.getNodes([p]).then(k=>{const L=u(k[p]);if(L){if(R.isFolder(p))for(const O in L.itemsMap)L.itemsMap.hasOwnProperty(O)&&L.itemsMap[O]===!1&&delete L.itemsMap[O];return{statusCode:200,body:L.body||L.itemsMap,contentType:L.contentType}}return{statusCode:404}})}put(p,h,C){const k=R.pathsFromRoot(p);return this._updateNodes(k,function(L,O){try{for(let e=0,s=L.length;e<s;e++){const i=L[e];let _,d=O[i];d||(O[i]=d=y(i)),e===0?(_=u(d),d.local={body:h,contentType:C,previousBody:_?_.body:void 0,previousContentType:_?_.contentType:void 0}):d=f(d,L[e-1].substring(i.length))}return O}catch(e){throw w.default("[Cachinglayer] Error during PUT",O,e),e}})}delete(p){const h=R.pathsFromRoot(p);return this._updateNodes(h,function(C,k){for(let L=0,O=C.length;L<O;L++){const e=C[L],s=k[e];let i;if(s)if(L===0)i=u(s),s.local={body:!1,previousBody:i?i.body:void 0,previousContentType:i?i.contentType:void 0};else{s.local||(s.local=R.deepClone(s.common));const _=C[L-1].substring(e.length);if(delete s.local.itemsMap[_],Object.getOwnPropertyNames(s.local.itemsMap).length>0)break}else console.error("Cannot delete non-existing node "+e)}return k})}flush(p){return this._getAllDescendentPaths(p).then(h=>this.getNodes(h)).then(h=>{for(const C in h){const k=h[C];k&&k.common&&k.local&&this._emitChange({path:k.path,origin:"local",oldValue:k.local.body===!1?void 0:k.local.body,newValue:k.common.body===!1?void 0:k.common.body}),h[C]=void 0}return this.setNodes(h)})}_emitChange(p){g.default.changeEvents[p.origin]&&this._emit("change",p)}fireInitial(){g.default.changeEvents.local&&this.forAllNodes(p=>{if(R.isDocument(p.path)){const h=u(p);h&&this._emitChange({path:p.path,origin:"local",oldValue:void 0,oldContentType:void 0,newValue:h.body,newContentType:h.contentType})}}).then(()=>{this._emit("local-events-done")})}onDiff(p){this.diffHandler=p}migrate(p){return typeof p!="object"||p.common||(p.common={},typeof p.path=="string"?p.path.substr(-1)==="/"&&typeof p.body=="object"&&(p.common.itemsMap=p.body):(p.local||(p.local={}),p.local.body=p.body,p.local.contentType=p.contentType)),p}_updateNodes(p,h){return new Promise((C,k)=>{this._doUpdateNodes(p,h,{resolve:C,reject:k})})}_doUpdateNodes(p,h,C){this._updateNodesRunning?this._updateNodesQueued.push({paths:p,cb:h,promise:C}):(this._updateNodesRunning=!0,this.getNodes(p).then(k=>{const L=R.deepClone(k),O=[];k=h(p,k);for(const e in k){const s=k[e];R.equal(s,L[e])?delete k[e]:R.isDocument(e)&&(R.equal(s.local.body,s.local.previousBody)&&s.local.contentType===s.local.previousContentType||O.push({path:e,origin:"window",oldValue:s.local.previousBody,newValue:s.local.body===!1?void 0:s.local.body,oldContentType:s.local.previousContentType,newContentType:s.local.contentType}),delete s.local.previousBody,delete s.local.previousContentType)}this.setNodes(k).then(()=>{this._emitChangeEvents(O),C.resolve({statusCode:200})})}).then(()=>Promise.resolve(),k=>{C.reject(k)}).then(()=>{this._updateNodesRunning=!1;const k=this._updateNodesQueued.shift();k&&this._doUpdateNodes(k.paths,k.cb,k.promise)}))}_emitChangeEvents(p){for(let h=0,C=p.length;h<C;h++)this._emitChange(p[h]),this.diffHandler&&this.diffHandler(p[h].path)}_getAllDescendentPaths(p){return R.isFolder(p)?this.getNodes([p]).then(h=>{const C=[p],k=u(h[p]),L=Object.keys(k.itemsMap).map(O=>this._getAllDescendentPaths(p+O).then(e=>{for(let s=0,i=e.length;s<i;s++)C.push(e[s])}));return Promise.all(L).then(()=>C)}):Promise.resolve([p])}_getInternals(){return{getLatest:u,makeNode:y,isOutdated:A}}}function u(c){if(typeof c=="object"&&typeof c.path=="string")if(R.isFolder(c.path)){if(c.local&&c.local.itemsMap)return c.local;if(c.common&&c.common.itemsMap)return c.common}else{if(c.local){if(c.local.body&&c.local.contentType)return c.local;if(c.local.body===!1)return}if(c.common&&c.common.body&&c.common.contentType)return c.common;if(c.body&&c.contentType)return{body:c.body,contentType:c.contentType}}}function A(c,p){for(const h in c){if(c[h]&&c[h].remote)return!0;const C=u(c[h]);if(C&&C.timestamp&&new Date().getTime()-C.timestamp<=p)return!1;if(!C)return!0}return!0}function y(c){const p={path:c,common:{}};return R.isFolder(c)&&(p.common.itemsMap={}),p}function f(c,p){return c.common||(c.common={itemsMap:{}}),c.common.itemsMap||(c.common.itemsMap={}),c.local||(c.local=R.deepClone(c.common)),c.local.itemsMap||(c.local.itemsMap=c.common.itemsMap),c.local.itemsMap[p]=!0,c}R.applyMixins(b,[m.default]),F.exports=b},function(F,D,E){F.exports=class{constructor(){this.reset()}static _rs_init(){}get scopes(){return Object.keys(this.scopeModeMap).map(l=>({name:l,mode:this.scopeModeMap[l]}))}get scopeParameter(){return this.scopes.map(l=>`${this._scopeNameForParameter(l)}:${l.mode}`).join(" ")}claim(l,m){if(typeof l!="string"||l.indexOf("/")!==-1||l.length===0)throw new Error("Scope should be a non-empty string without forward slashes");if(!m.match(/^rw?$/))throw new Error("Mode should be either 'r' or 'rw'");this._adjustRootPaths(l),this.scopeModeMap[l]=m}get(l){return this.scopeModeMap[l]}remove(l){const m={};for(const g in this.scopeModeMap)m[g]=this.scopeModeMap[g];this.reset(),delete m[l];for(const g in m)this.claim(g,m[g])}checkPermission(l,m){const g=this.get(l);return g&&(m==="r"||g==="rw")}checkPathPermission(l,m){if(this.checkPermission("*",m))return!0;const g=this._getModuleName(l);return!!this.checkPermission(g,m)}reset(){this.rootPaths=[],this.scopeModeMap={}}_getModuleName(l){if(l[0]!=="/")throw new Error("Path should start with a slash");const m=l.replace(/^\/public/,"").match(/^\/([^/]*)\//);return m?m[1]:"*"}_adjustRootPaths(l){"*"in this.scopeModeMap||l==="*"?this.rootPaths=["/"]:l in this.scopeModeMap||(this.rootPaths.push("/"+l+"/"),this.rootPaths.push("/public/"+l+"/"))}_scopeNameForParameter(l){if(l.name==="*"&&this.storageType){if(this.storageType==="2012.04")return"";if(this.storageType.match(/remotestorage-0[01]/))return"root"}return l.name}setStorageType(l){this.storageType=l}}},function(F,D,E){var l=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};const m=E(0),g=l(E(1));F.exports=class{constructor(){this.pendingActivations=[],this.reset()}set(w,R){if(typeof w!="string")throw new Error("path should be a string");if(!m.isFolder(w))throw new Error("path should be a folder");if(!R.match(/^(FLUSH|SEEN|ALL)$/))throw new Error("strategy should be 'FLUSH', 'SEEN', or 'ALL'");this._rootPaths[w]=R,R==="ALL"&&(this.activateHandler?this.activateHandler(w):this.pendingActivations.push(w))}enable(w){this.set(w,"ALL")}disable(w){this.set(w,"FLUSH")}onActivate(w){g.default("[Caching] Setting activate handler",w,this.pendingActivations),this.activateHandler=w;for(let R=0;R<this.pendingActivations.length;R++)w(this.pendingActivations[R]);this.pendingActivations=[]}checkPath(w){return this._rootPaths[w]!==void 0?this._rootPaths[w]:w==="/"?"SEEN":this.checkPath(m.containingFolder(w))}reset(){this._rootPaths={}}static _rs_init(){}}},function(F,D,E){var l=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};const m=l(E(7)),g=l(E(8)),w=l(E(2)),R=E(0),b="https://www.googleapis.com",u="remotestorage:googledrive";let A;function y(L){return L.substr(-1)==="/"&&(L=L.substr(0,L.length-1)),decodeURIComponent(L)}function f(L){return L.replace(/[^\/]+\/?$/,"")}function c(L){const O=L.split("/");return L.substr(-1)==="/"?O[O.length-2]+"/":O[O.length-1]}function p(L){return R.cleanPath("/remotestorage/"+L)}function h(L){return L.replace(/^["'](.*)["']$/,"$1")}class C{constructor(O){this._items={},this.maxAge=O,this._items={}}get(O){const e=this._items[O],s=new Date().getTime();return e&&e.t>=s-this.maxAge?e.v:void 0}set(O,e){this._items[O]={v:e,t:new Date().getTime()}}}class k{constructor(O,e){if(this.connected=!1,this.online=!0,this.addEvents(["connected","not-connected"]),this.rs=O,this.clientId=e,this._fileIdCache=new C(300),A=R.localStorageAvailable(),A){const s=R.getJSONFromLocalStorage(u);s&&this.configure(s)}}configure(O){O.userAddress!==void 0&&(this.userAddress=O.userAddress),O.token!==void 0&&(this.token=O.token);const e=function(){A&&localStorage.setItem(u,JSON.stringify({userAddress:this.userAddress,token:this.token}))},s=function(){this.connected=!1,delete this.token,A&&localStorage.removeItem(u)};this.token?(this.connected=!0,this.userAddress?(this._emit("connected"),e.apply(this)):this.info().then(i=>{this.userAddress=i.user.emailAddress,this._emit("connected"),e.apply(this)}).catch(()=>{s.apply(this),this.rs._emit("error",new Error("Could not fetch user info."))})):s.apply(this)}connect(){this.rs.setBackend("googledrive"),this.rs.authorize({authURL:"https://accounts.google.com/o/oauth2/auth",scope:"https://www.googleapis.com/auth/drive",clientId:this.clientId})}stopWaitingForToken(){this.connected||this._emit("not-connected")}get(O,e){return R.isFolder(O)?this._getFolder(p(O)):this._getFile(p(O),e)}put(O,e,s,i){const _=p(O);function d(S){if(S.status>=200&&S.status<300){const q=JSON.parse(S.responseText),B=h(q.etag);return Promise.resolve({statusCode:200,contentType:q.mimeType,revision:B})}return S.status===412?Promise.resolve({statusCode:412,revision:"conflict"}):Promise.reject("PUT failed with status "+S.status+" ("+S.responseText+")")}return this._getFileId(_).then(S=>S?i&&i.ifNoneMatch==="*"?d({status:412}):this._updateFile(S,_,e,s,i).then(d):this._createFile(_,e,s).then(d))}delete(O,e){const s=p(O);return this._getFileId(s).then(i=>i?this._getMeta(i).then(_=>{let d;return typeof _=="object"&&typeof _.etag=="string"&&(d=h(_.etag)),e&&e.ifMatch&&e.ifMatch!==d?{statusCode:412,revision:d}:this._request("DELETE",b+"/drive/v2/files/"+i,{}).then(S=>S.status===200||S.status===204?{statusCode:200}:Promise.reject("Delete failed: "+S.status+" ("+S.responseText+")"))}):Promise.resolve({statusCode:200}))}info(){return this._request("GET","https://www.googleapis.com/drive/v2/about?fields=user",{}).then(function(O){try{const e=JSON.parse(O.responseText);return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}_updateFile(O,e,s,i,_){const d={mimeType:i},S={"Content-Type":"application/json; charset=UTF-8"};return _&&_.ifMatch&&(S["If-Match"]='"'+_.ifMatch+'"'),this._request("PUT",b+"/upload/drive/v2/files/"+O+"?uploadType=resumable",{body:JSON.stringify(d),headers:S}).then(q=>q.status===412?q:this._request("PUT",q.getResponseHeader("Location"),{body:i.match(/^application\/json/)?JSON.stringify(s):s}))}_createFile(O,e,s){return this._getParentId(O).then(i=>{const _={title:y(c(O)),mimeType:s,parents:[{kind:"drive#fileLink",id:i}]};return this._request("POST",b+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(_),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(d=>this._request("POST",d.getResponseHeader("Location"),{body:s.match(/^application\/json/)?JSON.stringify(e):e}))})}_getFile(O,e){return this._getFileId(O).then(s=>this._getMeta(s).then(i=>{let _;if(typeof i=="object"&&typeof i.etag=="string"&&(_=h(i.etag)),e&&e.ifNoneMatch&&_===e.ifNoneMatch)return Promise.resolve({statusCode:304});if(!i.downloadUrl){if(!i.exportLinks||!i.exportLinks["text/html"])return Promise.resolve({statusCode:200,body:"",contentType:i.mimeType,revision:_});i.mimeType+=";export=text/html",i.downloadUrl=i.exportLinks["text/html"]}return this._request("GET",i.downloadUrl,{responseType:"arraybuffer"}).then(d=>R.getTextFromArrayBuffer(d.response,"UTF-8").then(function(S){let q=S;if(i.mimeType.match(/^application\/json/))try{q=JSON.parse(q)}catch{}else R.shouldBeTreatedAsBinary(S,i.mimeType)&&(q=d.response);return{statusCode:200,body:q,contentType:i.mimeType,revision:_}}))}))}_getFolder(O){return this._getFileId(O).then(e=>{let s,i,_;if(!e)return Promise.resolve({statusCode:404});const d="'"+e+"' in parents";return this._request("GET",b+"/drive/v2/files?q="+encodeURIComponent(d)+"&fields="+encodeURIComponent("items(downloadUrl,etag,fileSize,id,mimeType,title,labels)")+"&maxResults=1000&trashed=false",{}).then(S=>{var q;if(S.status!==200)return Promise.reject("request failed or something: "+S.status);try{s=JSON.parse(S.responseText)}catch{return Promise.reject("non-JSON response from GoogleDrive")}_={};for(const B of s.items)!((q=B.labels)===null||q===void 0)&&q.trashed||(i=h(B.etag),B.mimeType==="application/vnd.google-apps.folder"?(this._fileIdCache.set(O+R.cleanPath(B.title)+"/",B.id),_[B.title+"/"]={ETag:i}):(this._fileIdCache.set(O+R.cleanPath(B.title),B.id),_[B.title]={ETag:i,"Content-Type":B.mimeType,"Content-Length":B.fileSize}));return Promise.resolve({statusCode:200,body:_,contentType:"application/json; charset=UTF-8",revision:void 0})})})}_getParentId(O){const e=f(O);return this._getFileId(e).then(s=>s?Promise.resolve(s):this._createFolder(e))}_createFolder(O){return this._getParentId(O).then(e=>this._request("POST",b+"/drive/v2/files",{body:JSON.stringify({title:y(c(O)),mimeType:"application/vnd.google-apps.folder",parents:[{id:e}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(s=>{const i=JSON.parse(s.responseText);return Promise.resolve(i.id)}))}_getFileId(O){let e;return O==="/"?Promise.resolve("root"):(e=this._fileIdCache.get(O))?Promise.resolve(e):this._getFolder(f(O)).then(()=>(e=this._fileIdCache.get(O),e?Promise.resolve(e):O.substr(-1)==="/"?this._createFolder(O).then(()=>this._getFileId(O)):Promise.resolve()))}_getMeta(O){return this._request("GET",b+"/drive/v2/files/"+O,{}).then(function(e){return e.status===200?Promise.resolve(JSON.parse(e.responseText)):Promise.reject("request (getting metadata for "+O+") failed with status: "+e.status)})}_request(O,e,s){return s.headers||(s.headers={}),s.headers.Authorization="Bearer "+this.token,this.rs._emit("wire-busy",{method:O,isFolder:R.isFolder(e)}),g.default.request.call(this,O,e,s).then(i=>i&&i.status===401?void this.connect():(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:O,isFolder:R.isFolder(e),success:!0}),Promise.resolve(i)),i=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:O,isFolder:R.isFolder(e),success:!1}),Promise.reject(i)))}static _rs_init(O){const e=O.apiKeys.googledrive;var s;e&&(O.googledrive=new k(O,e.clientId),O.backend==="googledrive"&&(O._origRemote=O.remote,O.remote=O.googledrive,(s=O)._origBaseClientGetItemURL||(s._origBaseClientGetItemURL=m.default.prototype.getItemURL,m.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Google Drive yet")})))}static _rs_supported(){return!0}static _rs_cleanup(O){var e;O.setBackend(void 0),O._origRemote&&(O.remote=O._origRemote,delete O._origRemote),(e=O)._origBaseClientGetItemURL&&(m.default.prototype.getItemURL=e._origBaseClientGetItemURL,delete e._origBaseClientGetItemURL)}}R.applyMixins(k,[w.default]),F.exports=k},function(F,D,E){var l=this&&this.__awaiter||function(s,i,_,d){return new(_||(_=Promise))(function(S,q){function B(N){try{P(d.next(N))}catch(r){q(r)}}function U(N){try{P(d.throw(N))}catch(r){q(r)}}function P(N){var r;N.done?S(N.value):(r=N.value,r instanceof _?r:new _(function(o){o(r)})).then(B,U)}P((d=d.apply(s,i||[])).next())})},m=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};const g=m(E(2)),w=m(E(8)),R=m(E(7)),b=m(E(26)),u=m(E(9)),A=m(E(4)),y=E(0);let f;const c="remotestorage:dropbox";function p(s){return y.cleanPath("/remotestorage/"+s).replace(/\/$/,"")}function h(s,i){return new RegExp("^"+i.join("\\/")+"(\\/|$)").test(s.error_summary)}function C(s){return s instanceof ArrayBuffer||w.default.isArrayBufferView(s)}class k{constructor(i){if(this.rs=i,this.connected=!1,this.online=!0,this._initialFetchDone=!1,this.addEvents(["connected","not-connected"]),this.clientId=i.apiKeys.dropbox.appKey,this._revCache=new b.default("rev"),this._fetchDeltaCursor=null,this._fetchDeltaPromise=null,this._itemRefs={},f=y.localStorageAvailable(),f){const _=y.getJSONFromLocalStorage(c);_&&this.configure(_),this._itemRefs=y.getJSONFromLocalStorage(c+":shares")||{}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}connect(){this.rs.setBackend("dropbox"),this.token?e(this.rs):this.rs.authorize({authURL:"https://www.dropbox.com/oauth2/authorize",scope:"",clientId:this.clientId})}configure(i){i.userAddress!==void 0&&(this.userAddress=i.userAddress),i.token!==void 0&&(this.token=i.token);const _=function(){f&&localStorage.setItem(c,JSON.stringify({userAddress:this.userAddress,token:this.token}))},d=function(){this.connected=!1,f&&localStorage.removeItem(c)};this.token?(this.connected=!0,this.userAddress?(this._emit("connected"),_.apply(this)):this.info().then(function(S){this.userAddress=S.email,this._emit("connected"),_.apply(this)}.bind(this)).catch(function(){d.apply(this),this.rs._emit("error",new Error("Could not fetch user info."))}.bind(this))):d.apply(this)}stopWaitingForToken(){this.connected||this._emit("not-connected")}_getFolder(i){const _=this._revCache,d=q=>{let B;if(q.status!==200&&q.status!==409)return Promise.reject("Unexpected response status: "+q.status);try{B=JSON.parse(q.responseText)}catch(P){return Promise.reject(P)}if(q.status===409)return h(B,["path","not_found"])?Promise.resolve({}):Promise.reject(new Error("API returned an error: "+B.error_summary));const U=B.entries.reduce((P,N)=>{const r=N[".tag"]==="folder",o=N.path_lower.split("/").slice(-1)[0]+(r?"/":"");return r?P[o]={ETag:_.get(i+o)}:(P[o]={ETag:N.rev},this._revCache.set(i+o,N.rev)),P},{});return B.has_more?S(B.cursor).then(function(P){return Object.assign(U,P)}):Promise.resolve(U)},S=q=>{const B={body:{cursor:q}};return this._request("POST","https://api.dropboxapi.com/2/files/list_folder/continue",B).then(d)};return this._request("POST","https://api.dropboxapi.com/2/files/list_folder",{body:{path:p(i)}}).then(d).then(function(q){return Promise.resolve({statusCode:200,body:q,contentType:"application/json; charset=UTF-8",revision:_.get(i)})})}get(i,_){if(!this.connected)return Promise.reject("not connected (path: "+i+")");const d=this._revCache.get(i);if(d===null)return Promise.resolve({statusCode:404});if(_&&_.ifNoneMatch){if(!this._initialFetchDone)return this.fetchDelta().then(()=>this.get(i,_));if(d&&d===_.ifNoneMatch)return Promise.resolve({statusCode:304})}if(i.substr(-1)==="/")return this._getFolder(i);const S={headers:{"Dropbox-API-Arg":JSON.stringify({path:p(i)})},responseType:"arraybuffer"};return _&&_.ifNoneMatch&&(S.headers["If-None-Match"]=_.ifNoneMatch),this._request("GET","https://content.dropboxapi.com/2/files/download",S).then(q=>{const B=q.status;let U,P,N,r;return B!==200&&B!==409?Promise.resolve({statusCode:B}):(U=q.getResponseHeader("Dropbox-API-Result"),y.getTextFromArrayBuffer(q.response,"UTF-8").then(o=>{P=o,B===409&&(U=P);try{U=JSON.parse(U)}catch(v){return Promise.reject(v)}if(B===409)return h(U,["path","not_found"])?{statusCode:404}:Promise.reject(new Error('API error while downloading file ("'+i+'"): '+U.error_summary));if(N=q.getResponseHeader("Content-Type"),r=U.rev,this._revCache.set(i,r),this._shareIfNeeded(i),y.shouldBeTreatedAsBinary(o,N))P=q.response;else try{P=JSON.parse(P),N="application/json; charset=UTF-8"}catch{}return{statusCode:B,body:P,contentType:N,revision:r}}))})}put(i,_,d,S){if(!this.connected)throw new Error("not connected (path: "+i+")");const q=this._revCache.get(i);if(S&&S.ifMatch&&q&&q!==S.ifMatch)return Promise.resolve({statusCode:412,revision:q});if(S&&S.ifNoneMatch==="*"&&q&&q!=="rev")return Promise.resolve({statusCode:412,revision:q});if(!d.match(/charset=/)&&C(_)&&(d+="; charset=binary"),_.length>157286400)return Promise.reject(new Error("Cannot upload file larger than 150MB"));let B;const U=S&&(S.ifMatch||S.ifNoneMatch==="*"),P={body:_,contentType:d,path:i};return B=U?this._getMetadata(i).then(N=>S&&S.ifNoneMatch==="*"&&N||S&&S.ifMatch&&N&&N.rev!==S.ifMatch?Promise.resolve({statusCode:412,revision:N.rev}):this._uploadSimple(P)):this._uploadSimple(P),B.then(N=>(this._shareIfNeeded(i),N))}delete(i,_){if(!this.connected)throw new Error("not connected (path: "+i+")");const d=this._revCache.get(i);return _&&_.ifMatch&&d&&_.ifMatch!==d?Promise.resolve({statusCode:412,revision:d}):_&&_.ifMatch?this._getMetadata(i).then(S=>_&&_.ifMatch&&S&&S.rev!==_.ifMatch?Promise.resolve({statusCode:412,revision:S.rev}):this._deleteSimple(i)):this._deleteSimple(i)}_shareIfNeeded(i){i.match(/^\/public\/.*[^/]$/)&&this._itemRefs[i]===void 0&&this.share(i)}share(i){const _={body:{path:p(i)}};return this._request("POST","https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings",_).then(d=>{if(d.status!==200&&d.status!==409)return Promise.reject(new Error("Invalid response status:"+d.status));let S;try{S=JSON.parse(d.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+d.responseText))}return d.status===409?h(S,["shared_link_already_exists"])?this._getSharedLink(i):Promise.reject(new Error("API error: "+S.error_summary)):Promise.resolve(S.url)}).then(d=>(this._itemRefs[i]=d,f&&localStorage.setItem(c+":shares",JSON.stringify(this._itemRefs)),Promise.resolve(d)),d=>(d.message='Sharing Dropbox file or folder ("'+i+'") failed: '+d.message,Promise.reject(d)))}info(){return this._request("POST","https://api.dropboxapi.com/2/users/get_current_account",{}).then(function(i){let _=i.responseText;try{_=JSON.parse(_)}catch{return Promise.reject(new Error("Could not query current account info: Invalid API response: "+_))}return Promise.resolve({email:_.email})})}_request(i,_,d){return d.headers||(d.headers={}),d.headers.Authorization="Bearer "+this.token,typeof d.body!="object"||C(d.body)||(d.body=JSON.stringify(d.body),d.headers["Content-Type"]="application/json; charset=UTF-8"),this.rs._emit("wire-busy",{method:i,isFolder:y.isFolder(_)}),w.default.request.call(this,i,_,d).then(S=>S&&S.status===503?(this.online&&(this.online=!1,this.rs._emit("network-offline")),setTimeout(this._request(i,_,d),3210)):(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:i,isFolder:y.isFolder(_),success:!0}),Promise.resolve(S)),S=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:i,isFolder:y.isFolder(_),success:!1}),Promise.reject(S)))}fetchDelta(...i){if(this._fetchDeltaPromise)return this._fetchDeltaPromise;const _=d=>{let S,q="https://api.dropboxapi.com/2/files/list_folder";return typeof d=="string"?(q+="/continue",S={cursor:d}):S={path:"/remotestorage",recursive:!0,include_deleted:!0},this._request("POST",q,{body:S}).then(B=>{if(B.status===401)return this.rs._emit("error",new A.default),Promise.resolve(i);if(B.status!==200&&B.status!==409)return Promise.reject(new Error("Invalid response status: "+B.status));let U;try{U=JSON.parse(B.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+B.responseText))}if(B.status===409){if(!h(U,["path","not_found"]))return Promise.reject(new Error("API returned an error: "+U.error_summary));U={cursor:null,entries:[],has_more:!1}}if(d||this._revCache.deactivatePropagation(),U.entries.forEach(P=>{const N=P.path_lower.substr(14);P[".tag"]==="deleted"?(this._revCache.delete(N),this._revCache.delete(N+"/")):P[".tag"]==="file"&&this._revCache.set(N,P.rev)}),this._fetchDeltaCursor=U.cursor,U.has_more)return _(U.cursor);this._revCache.activatePropagation(),this._initialFetchDone=!0}).catch(B=>B==="timeout"||B instanceof ProgressEvent?Promise.resolve():Promise.reject(B))};return this._fetchDeltaPromise=_(this._fetchDeltaCursor).catch(d=>(typeof d=="object"&&"message"in d?d.message="Dropbox: fetchDelta: "+d.message:d="Dropbox: fetchDelta: "+d,this._fetchDeltaPromise=null,Promise.reject(d))).then(()=>(this._fetchDeltaPromise=null,Promise.resolve(i))),this._fetchDeltaPromise}_getMetadata(i){const _={path:p(i)};return this._request("POST","https://api.dropboxapi.com/2/files/get_metadata",{body:_}).then(d=>{if(d.status!==200&&d.status!==409)return Promise.reject(new Error("Invalid response status:"+d.status));let S;try{S=JSON.parse(d.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+d.responseText))}return d.status===409?h(S,["path","not_found"])?Promise.resolve():Promise.reject(new Error("API error: "+S.error_summary)):Promise.resolve(S)}).then(void 0,d=>(d.message='Could not load metadata for file or folder ("'+i+'"): '+d.message,Promise.reject(d)))}_uploadSimple(i){const _={path:p(i.path),mode:{".tag":"overwrite",update:void 0},mute:!0};return i.ifMatch&&(_.mode={".tag":"update",update:i.ifMatch}),this._request("POST","https://content.dropboxapi.com/2/files/upload",{body:i.body,headers:{"Content-Type":"application/octet-stream","Dropbox-API-Arg":JSON.stringify(_)}}).then(d=>{if(d.status!==200&&d.status!==409)return Promise.resolve({statusCode:d.status});let S=d.responseText;try{S=JSON.parse(S)}catch{return Promise.reject(new Error("Invalid API result: "+S))}return d.status===409?h(S,["path","conflict"])?this._getMetadata(i.path).then(function(q){return Promise.resolve({statusCode:412,revision:q.rev})}):Promise.reject(new Error("API error: "+S.error_summary)):(this._revCache.set(i.path,S.rev),Promise.resolve({statusCode:d.status,revision:S.rev}))})}_deleteSimple(i){const _={path:p(i)};return this._request("POST","https://api.dropboxapi.com/2/files/delete",{body:_}).then(d=>{if(d.status!==200&&d.status!==409)return Promise.resolve({statusCode:d.status});let S=d.responseText;try{S=JSON.parse(S)}catch{return Promise.reject(new Error("Invalid response body: "+S))}return d.status===409?h(S,["path_lookup","not_found"])?Promise.resolve({statusCode:404}):Promise.reject(new Error("API error: "+S.error_summary)):Promise.resolve({statusCode:200})}).then(d=>(d.statusCode!==200&&d.statusCode!==404||(this._revCache.delete(i),delete this._itemRefs[i]),Promise.resolve(d)),d=>(d.message='Could not delete Dropbox file or folder ("'+i+'"): '+d.message,Promise.reject(d)))}_getSharedLink(i){return l(this,void 0,void 0,function*(){const _={body:{path:p(i),direct_only:!0}};return this._request("POST","https://api.dropbox.com/2/sharing/list_shared_links",_).then(d=>{if(d.status!==200&&d.status!==409)return Promise.reject(new Error("Invalid response status: "+d.status));let S;try{S=JSON.parse(d.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+d.responseText))}return d.status===409?Promise.reject(new Error("API error: "+d.error_summary)):S.links.length?Promise.resolve(S.links[0].url):Promise.reject(new Error("No links returned"))},d=>(d.message='Could not get link to a shared file or folder ("'+i+'"): '+d.message,Promise.reject(d)))})}static _rs_init(i){f=y.localStorageAvailable(),i.apiKeys.dropbox&&(i.dropbox=new k(i)),i.backend==="dropbox"&&e(i)}static _rs_supported(){return!0}static _rs_cleanup(i){(function(_){(function(d){d._origRemote&&(d.remote=d._origRemote,delete d._origRemote)})(_),function(d){!d._dropboxOrigSync||(d.sync.sync=d._dropboxOrigSync,delete d._dropboxOrigSync)}(_),function(d){!d._origBaseClientGetItemURL||(R.default.prototype.getItemURL=d._origBaseClientGetItemURL,delete d._origBaseClientGetItemURL)}(_),O(_)})(i),f&&localStorage.removeItem(c),i.setBackend(void 0)}}function L(s,...i){s._dropboxOrigSync||(s._dropboxOrigSync=s.sync.sync.bind(s.sync),s.sync.sync=function(){return this.dropbox.fetchDelta(s,...i).then(s._dropboxOrigSync,function(_){s._emit("error",new u.default(_)),s._emit("sync-done")})}.bind(s))}function O(s){s._dropboxOrigSyncCycle&&(s.syncCycle=s._dropboxOrigSyncCycle,delete s._dropboxOrigSyncCycle)}function e(s){(function(i){i._origRemote||(i._origRemote=i.remote,i.remote=i.dropbox)})(s),s.sync?L(s):function(i,..._){i._dropboxOrigSyncCycle||(i._dropboxOrigSyncCycle=i.syncCycle,i.syncCycle=()=>{if(!i.sync)throw new Error("expected sync to be initialized by now");L(i),i._dropboxOrigSyncCycle(i,..._),O(i)})}(s),function(i){i._origBaseClientGetItemURL||(i._origBaseClientGetItemURL=R.default.prototype.getItemURL,R.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Dropbox yet")})}(s)}y.applyMixins(k,[g.default]),F.exports=k},function(F,D,E){var l=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};const m=l(E(27)),g=l(E(1)),w=E(0);let R,b,u={};const A=function(y){return new Promise((f,c)=>y in u?f(u[y]):new m.default({tls_only:!1,uri_fallback:!0,request_timeout:5e3}).lookup(y,function(p,h){if(p)return c(p);if(typeof h.idx.links.remotestorage!="object"||typeof h.idx.links.remotestorage.length!="number"||h.idx.links.remotestorage.length<=0)return g.default("[Discover] WebFinger record for "+y+" does not have remotestorage defined in the links section ",JSON.stringify(h.json)),c("WebFinger record for "+y+" does not have remotestorage defined in the links section.");const C=h.idx.links.remotestorage[0],k=C.properties["http://tools.ietf.org/html/rfc6749#section-4.2"]||C.properties["auth-endpoint"],L=C.properties["http://remotestorage.io/spec/version"]||C.type;return u[y]={href:C.href,storageApi:L,authURL:k,properties:C.properties},b&&(localStorage["remotestorage:discover"]=JSON.stringify({cache:u})),f(u[y])}))};(A.DiscoveryError=function(y){this.name="DiscoveryError",this.message=y,this.stack=new Error().stack}).prototype=Object.create(Error.prototype),A.DiscoveryError.prototype.constructor=A.DiscoveryError,A._rs_init=function(){if(b=w.localStorageAvailable(),b)try{u=JSON.parse(localStorage["remotestorage:discover"]).cache}catch{}},A._rs_supported=function(){return R=Object.prototype.hasOwnProperty.call(w.globalContext,"XMLHttpRequest"),R},A._rs_cleanup=function(){b&&delete localStorage["remotestorage:discover"]},F.exports=A},function(F,D,E){const l=(this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}})(E(2)),m=E(0);class g{constructor(){this.addEvents(["background","foreground"]),this.mode=typeof window!="undefined"?"browser":"node",this.mode==="browser"&&(this.setBrowserPrefixedNames(),document.addEventListener(this.visibilityChangeEvent,this.setVisibility.bind(this),!1),this.setVisibility())}setBrowserPrefixedNames(){this.mode==="browser"&&(document.hidden!==void 0?(this.hiddenProperty="hidden",this.visibilityChangeEvent="visibilitychange"):document.mozHidden!==void 0?(this.hiddenProperty="mozHidden",this.visibilityChangeEvent="mozvisibilitychange"):document.msHidden!==void 0?(this.hiddenProperty="msHidden",this.visibilityChangeEvent="msvisibilitychange"):document.webkitHidden!==void 0&&(this.hiddenProperty="webkitHidden",this.visibilityChangeEvent="webkitvisibilitychange"))}setVisibility(){document[this.hiddenProperty]?this.goBackground():this.goForeground()}isBrowser(){return this.mode==="browser"}isNode(){return this.mode==="node"}goBackground(){this._emit("background")}goForeground(){this._emit("foreground")}static _rs_init(){}static _rs_cleanup(){}}m.applyMixins(g,[l.default]),F.exports=g},function(F,D,E){F.exports=E(18)},function(F,D,E){var l=this&&this.__createBinding||(Object.create?function(U,P,N,r){r===void 0&&(r=N),Object.defineProperty(U,r,{enumerable:!0,get:function(){return P[N]}})}:function(U,P,N,r){r===void 0&&(r=N),U[r]=P[N]}),m=this&&this.__setModuleDefault||(Object.create?function(U,P){Object.defineProperty(U,"default",{enumerable:!0,value:P})}:function(U,P){U.default=P}),g=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var P={};if(U!=null)for(var N in U)N!=="default"&&Object.hasOwnProperty.call(U,N)&&l(P,U,N);return m(P,U),P},w=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};const R=w(E(3)),b=w(E(1)),u=E(0),A=w(E(11)),y=w(E(6)),f=w(E(7)),c=w(E(12)),p=w(E(2)),h=w(E(13)),C=w(E(14)),k=w(E(15)),L=w(E(9)),O=w(E(4)),e=w(E(29)),s=g(E(0)),i=u.getGlobalContext();let _;function d(U){return U.statusCode!==403&&U.statusCode!==401||this._emit("error",new O.default),Promise.resolve(U)}function S(U){return typeof U=="number"&&U>=2e3&&U<=36e5}class q{constructor(P){this._pending=[],this._cleanups=[],this._pathHandlers={change:{}},this.apiKeys={},this._init=e.default.loadFeatures,this.features=e.default.features,this.loadFeature=e.default.loadFeature,this.featureSupported=e.default.featureSupported,this.featureDone=e.default.featureDone,this.featuresDone=e.default.featuresDone,this.featuresLoaded=e.default.featuresLoaded,this.featureInitialized=e.default.featureInitialized,this.featureFailed=e.default.featureFailed,this.hasFeature=e.default.hasFeature,this._setCachingModule=e.default._setCachingModule,this._collectCleanupFunctions=e.default._collectCleanupFunctions,this._fireReady=e.default._fireReady,this.initFeature=e.default.initFeature,typeof P=="object"&&u.extend(R.default,P),this.addEvents(["ready","authing","connecting","connected","disconnected","not-connected","conflict","error","features-loaded","sync-interval-change","sync-req-done","sync-done","wire-busy","wire-done","network-offline","network-online"]),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")}),_=u.localStorageAvailable(),_&&(this.apiKeys=u.getJSONFromLocalStorage("remotestorage:api-keys")||{},this.setBackend(localStorage.getItem("remotestorage:backend")||"remotestorage"));const N=this.on;this.on=function(r,o){if(this._allLoaded)switch(r){case"features-loaded":setTimeout(o,0);break;case"ready":this.remote&&setTimeout(o,0);break;case"connected":this.remote&&this.remote.connected&&setTimeout(o,0);break;case"not-connected":this.remote&&!this.remote.connected&&setTimeout(o,0)}return N.call(this,r,o)},this._init(),this.fireInitial=function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this),this.on("ready",this.fireInitial.bind(this)),this.loadModules()}get connected(){return this.remote.connected}loadModules(){R.default.modules.forEach(this.addModule.bind(this))}authorize(P){if(this.access.setStorageType(this.remote.storageApi),P.scope===void 0&&(P.scope=this.access.scopeParameter),i.cordova)P.redirectUri=R.default.cordovaRedirectUri;else{const N=y.default.getLocation();let r=N.origin;N.pathname!=="/"&&(r+=N.pathname),P.redirectUri=r}P.clientId===void 0&&(P.clientId=P.redirectUri.match(/^(https?:\/\/[^/]+)/)[0]),y.default.authorize(this,P)}impliedauth(P,N){P=P||this.remote.storageApi,N=N||String(document.location),b.default("ImpliedAuth proceeding due to absent authURL; storageApi = "+P+" redirectUri = "+N),this.remote.configure({token:y.default.IMPLIED_FAKE_TOKEN}),document.location.href=N}connect(P,N){if(this.setBackend("remotestorage"),P.indexOf("@")<0&&!P.match(/^(https?:\/\/)?[^\s\/$\.?#]+\.[^\s]*$/))return void this._emit("error",new q.DiscoveryError("Not a valid user address or URL."));if(P.indexOf("@")<0&&!P.match(/^https?:\/\//)&&(P="https://"+P),i.cordova){if(typeof R.default.cordovaRedirectUri!="string")return void this._emit("error",new q.DiscoveryError("Please supply a custom HTTPS redirect URI for your Cordova app"));if(!i.cordova.InAppBrowser)return void this._emit("error",new q.DiscoveryError("Please include the InAppBrowser Cordova plugin to enable OAuth"))}this.remote.configure({userAddress:P}),this._emit("connecting");const r=setTimeout(()=>{this._emit("error",new q.DiscoveryError("No storage information found for this user address."))},R.default.discoveryTimeout);k.default(P).then(o=>{if(clearTimeout(r),this._emit("authing"),o.userAddress=P,this.remote.configure(o),!this.remote.connected)if(o.authURL)if(N===void 0)this.authorize({authURL:o.authURL});else{if(typeof N!="string")throw new Error("Supplied bearer token must be a string");b.default("Skipping authorization sequence and connecting with known token"),this.remote.configure({token:N})}else this.impliedauth()},()=>{clearTimeout(r),this._emit("error",new q.DiscoveryError("No storage information found for this user address."))})}reconnect(){this.remote.configure({token:null}),this.backend==="remotestorage"?this.connect(this.remote.userAddress):this.remote.connect()}disconnect(){this.remote&&this.remote.configure({userAddress:null,href:null,storageApi:null,token:null,properties:null}),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")});const P=this._cleanups.length;let N=0;const r=()=>{N++,N>=P&&(this._init(),this._emit("disconnected"))};P>0?this._cleanups.forEach(o=>{const v=o(this);typeof v=="object"&&typeof v.then=="function"?v.then(r):r()}):r()}setBackend(P){this.backend=P,_&&(P?localStorage.setItem("remotestorage:backend",P):localStorage.removeItem("remotestorage:backend"))}onChange(P,N){this._pathHandlers.change[P]||(this._pathHandlers.change[P]=[]),this._pathHandlers.change[P].push(N)}enableLog(){R.default.logging=!0}disableLog(){R.default.logging=!1}log(...P){b.default.apply(q,P)}setApiKeys(P){const N=[B.GOOGLE,B.DROPBOX];if(typeof P!="object"||!Object.keys(P).every(r=>N.includes(r)))return console.error("setApiKeys() was called with invalid arguments"),!1;Object.keys(P).forEach(r=>{const o=P[r];if(o){switch(r){case B.DROPBOX:this.apiKeys[B.DROPBOX]={appKey:o},this.dropbox!==void 0&&this.dropbox.clientId===o||C.default._rs_init(this);break;case B.GOOGLE:this.apiKeys[B.GOOGLE]={clientId:o},this.googledrive!==void 0&&this.googledrive.clientId===o||h.default._rs_init(this)}return!0}delete this.apiKeys[r]}),_&&localStorage.setItem("remotestorage:api-keys",JSON.stringify(this.apiKeys))}setCordovaRedirectUri(P){if(typeof P!="string"||!P.match(/http(s)?:\/\//))throw new Error("Cordova redirect URI must be a URI string");R.default.cordovaRedirectUri=P}_setGPD(P,N){function r(o){return function(...v){return o.apply(N,v).then(d.bind(this))}}this.get=r(P.get),this.put=r(P.put),this.delete=r(P.delete)}_pendingGPD(P){return(...N)=>{const r=Array.prototype.slice.call(N);return new Promise((o,v)=>{this._pending.push({method:P,args:r,promise:{resolve:o,reject:v}})})}}_processPending(){this._pending.forEach(P=>{try{this[P.method](...P.args).then(P.promise.resolve,P.promise.reject)}catch(N){P.promise.reject(N)}}),this._pending=[]}_bindChange(P){P.on("change",this._dispatchEvent.bind(this,"change"))}_dispatchEvent(P,N){Object.keys(this._pathHandlers[P]).forEach(r=>{const o=r.length;N.path.substr(0,o)===r&&this._pathHandlers[P][r].forEach(v=>{const T={};for(const x in N)T[x]=N[x];T.relativePath=N.path.replace(new RegExp("^"+r),"");try{v(T)}catch(x){console.error("'change' handler failed: ",x,x.stack),this._emit("error",x)}})})}scope(P){if(typeof P!="string")throw"Argument 'path' of baseClient.scope must be a string";return this.access.checkPathPermission(P,"r")||console.warn("WARNING: Please use remoteStorage.access.claim() to ask for access permissions first: https://remotestoragejs.readthedocs.io/en/latest/js-api/access.html#claim"),new f.default(this,P)}getSyncInterval(){return R.default.syncInterval}setSyncInterval(P){if(!S(P))throw P+" is not a valid sync interval";const N=R.default.syncInterval;R.default.syncInterval=P,this._emit("sync-interval-change",{oldValue:N,newValue:P})}getBackgroundSyncInterval(){return R.default.backgroundSyncInterval}setBackgroundSyncInterval(P){if(!S(P))throw P+" is not a valid sync interval";const N=R.default.backgroundSyncInterval;R.default.backgroundSyncInterval=P,this._emit("sync-interval-change",{oldValue:N,newValue:P})}getCurrentSyncInterval(){return R.default.isBackground?R.default.backgroundSyncInterval:R.default.syncInterval}getRequestTimeout(){return R.default.requestTimeout}setRequestTimeout(P){if(typeof P!="number")throw P+" is not a valid request timeout";R.default.requestTimeout=P}syncCycle(){this.sync&&!this.sync.stopped&&(this.on("sync-done",()=>{this.sync&&!this.sync.stopped&&(this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._syncTimer=setTimeout(this.sync.sync.bind(this.sync),this.getCurrentSyncInterval()))}),this.sync.sync())}startSync(){return R.default.cache?(this.sync.stopped=!1,this.syncStopped=!1,this.sync.sync()):(console.warn("Nothing to sync, because caching is disabled."),Promise.resolve())}stopSync(){clearTimeout(this._syncTimer),this._syncTimer=void 0,this.sync?this.sync.stopped=!0:this.syncStopped=!0}addModule(P){const N=P.name,r=P.builder;if(Object.defineProperty(this,N,{configurable:!0,get:function(){const o=this._loadModule(N,r);return Object.defineProperty(this,N,{value:o}),o}}),N.indexOf("-")!==-1){const o=N.replace(/\-[a-z]/g,function(v){return v[1].toUpperCase()});Object.defineProperty(this,o,{get:function(){return this[N]}})}}_loadModule(P,N){if(N)return N(new f.default(this,"/"+P+"/"),new f.default(this,"/public/"+P+"/")).exports;throw"Unknown module: "+P}}var B;q.Authorize=y.default,q.SyncError=L.default,q.Unauthorized=O.default,q.DiscoveryError=k.default.DiscoveryError,q.util=s,Object.defineProperty(q.prototype,"access",{get:function(){const U=new A.default;return Object.defineProperty(this,"access",{value:U}),U},configurable:!0}),Object.defineProperty(q.prototype,"caching",{configurable:!0,get:function(){const U=new c.default;return Object.defineProperty(this,"caching",{value:U}),U}}),u.applyMixins(q,[p.default]),function(U){U.GOOGLE="googledrive",U.DROPBOX="dropbox"}(B||(B={})),F.exports=q},function(F,D,E){(function(l){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var m=E(20),g=E(21),w=E(22);function R(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function b(t,n){if(R()<n)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(n)).__proto__=u.prototype:(t===null&&(t=new u(n)),t.length=n),t}function u(t,n,a){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,n,a);if(typeof t=="number"){if(typeof n=="string")throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return A(this,t,n,a)}function A(t,n,a,I){if(typeof n=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer!="undefined"&&n instanceof ArrayBuffer?function(M,j,Y,W){if(j.byteLength,Y<0||j.byteLength<Y)throw new RangeError("'offset' is out of bounds");if(j.byteLength<Y+(W||0))throw new RangeError("'length' is out of bounds");return j=Y===void 0&&W===void 0?new Uint8Array(j):W===void 0?new Uint8Array(j,Y):new Uint8Array(j,Y,W),u.TYPED_ARRAY_SUPPORT?(M=j).__proto__=u.prototype:M=c(M,j),M}(t,n,a,I):typeof n=="string"?function(M,j,Y){if(typeof Y=="string"&&Y!==""||(Y="utf8"),!u.isEncoding(Y))throw new TypeError('"encoding" must be a valid string encoding');var W=0|h(j,Y),et=(M=b(M,W)).write(j,Y);return et!==W&&(M=M.slice(0,et)),M}(t,n,a):function(M,j){if(u.isBuffer(j)){var Y=0|p(j.length);return(M=b(M,Y)).length===0||j.copy(M,0,0,Y),M}if(j){if(typeof ArrayBuffer!="undefined"&&j.buffer instanceof ArrayBuffer||"length"in j)return typeof j.length!="number"||(W=j.length)!=W?b(M,0):c(M,j);if(j.type==="Buffer"&&w(j.data))return c(M,j.data)}var W;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,n)}function y(t){if(typeof t!="number")throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,n){if(y(n),t=b(t,n<0?0:0|p(n)),!u.TYPED_ARRAY_SUPPORT)for(var a=0;a<n;++a)t[a]=0;return t}function c(t,n){var a=n.length<0?0:0|p(n.length);t=b(t,a);for(var I=0;I<a;I+=1)t[I]=255&n[I];return t}function p(t){if(t>=R())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+R().toString(16)+" bytes");return 0|t}function h(t,n){if(u.isBuffer(t))return t.length;if(typeof ArrayBuffer!="undefined"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;typeof t!="string"&&(t=""+t);var a=t.length;if(a===0)return 0;for(var I=!1;;)switch(n){case"ascii":case"latin1":case"binary":return a;case"utf8":case"utf-8":case void 0:return rt(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*a;case"hex":return a>>>1;case"base64":return tt(t).length;default:if(I)return rt(t).length;n=(""+n).toLowerCase(),I=!0}}function C(t,n,a){var I=!1;if((n===void 0||n<0)&&(n=0),n>this.length||((a===void 0||a>this.length)&&(a=this.length),a<=0)||(a>>>=0)<=(n>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return N(this,n,a);case"utf8":case"utf-8":return B(this,n,a);case"ascii":return U(this,n,a);case"latin1":case"binary":return P(this,n,a);case"base64":return q(this,n,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r(this,n,a);default:if(I)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),I=!0}}function k(t,n,a){var I=t[n];t[n]=t[a],t[a]=I}function L(t,n,a,I,M){if(t.length===0)return-1;if(typeof a=="string"?(I=a,a=0):a>2147483647?a=2147483647:a<-2147483648&&(a=-2147483648),a=+a,isNaN(a)&&(a=M?0:t.length-1),a<0&&(a=t.length+a),a>=t.length){if(M)return-1;a=t.length-1}else if(a<0){if(!M)return-1;a=0}if(typeof n=="string"&&(n=u.from(n,I)),u.isBuffer(n))return n.length===0?-1:O(t,n,a,I,M);if(typeof n=="number")return n&=255,u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?M?Uint8Array.prototype.indexOf.call(t,n,a):Uint8Array.prototype.lastIndexOf.call(t,n,a):O(t,[n],a,I,M);throw new TypeError("val must be string, number or Buffer")}function O(t,n,a,I,M){var j,Y=1,W=t.length,et=n.length;if(I!==void 0&&((I=String(I).toLowerCase())==="ucs2"||I==="ucs-2"||I==="utf16le"||I==="utf-16le")){if(t.length<2||n.length<2)return-1;Y=2,W/=2,et/=2,a/=2}function Q(ct,dt){return Y===1?ct[dt]:ct.readUInt16BE(dt*Y)}if(M){var $=-1;for(j=a;j<W;j++)if(Q(t,j)===Q(n,$===-1?0:j-$)){if($===-1&&($=j),j-$+1===et)return $*Y}else $!==-1&&(j-=j-$),$=-1}else for(a+et>W&&(a=W-et),j=a;j>=0;j--){for(var it=!0,st=0;st<et;st++)if(Q(t,j+st)!==Q(n,st)){it=!1;break}if(it)return j}return-1}function e(t,n,a,I){a=Number(a)||0;var M=t.length-a;I?(I=Number(I))>M&&(I=M):I=M;var j=n.length;if(j%2!=0)throw new TypeError("Invalid hex string");I>j/2&&(I=j/2);for(var Y=0;Y<I;++Y){var W=parseInt(n.substr(2*Y,2),16);if(isNaN(W))return Y;t[a+Y]=W}return Y}function s(t,n,a,I){return K(rt(n,t.length-a),t,a,I)}function i(t,n,a,I){return K(function(M){for(var j=[],Y=0;Y<M.length;++Y)j.push(255&M.charCodeAt(Y));return j}(n),t,a,I)}function _(t,n,a,I){return i(t,n,a,I)}function d(t,n,a,I){return K(tt(n),t,a,I)}function S(t,n,a,I){return K(function(M,j){for(var Y,W,et,Q=[],$=0;$<M.length&&!((j-=2)<0);++$)Y=M.charCodeAt($),W=Y>>8,et=Y%256,Q.push(et),Q.push(W);return Q}(n,t.length-a),t,a,I)}function q(t,n,a){return n===0&&a===t.length?m.fromByteArray(t):m.fromByteArray(t.slice(n,a))}function B(t,n,a){a=Math.min(t.length,a);for(var I=[],M=n;M<a;){var j,Y,W,et,Q=t[M],$=null,it=Q>239?4:Q>223?3:Q>191?2:1;if(M+it<=a)switch(it){case 1:Q<128&&($=Q);break;case 2:(192&(j=t[M+1]))==128&&(et=(31&Q)<<6|63&j)>127&&($=et);break;case 3:j=t[M+1],Y=t[M+2],(192&j)==128&&(192&Y)==128&&(et=(15&Q)<<12|(63&j)<<6|63&Y)>2047&&(et<55296||et>57343)&&($=et);break;case 4:j=t[M+1],Y=t[M+2],W=t[M+3],(192&j)==128&&(192&Y)==128&&(192&W)==128&&(et=(15&Q)<<18|(63&j)<<12|(63&Y)<<6|63&W)>65535&&et<1114112&&($=et)}$===null?($=65533,it=1):$>65535&&($-=65536,I.push($>>>10&1023|55296),$=56320|1023&$),I.push($),M+=it}return function(st){var ct=st.length;if(ct<=4096)return String.fromCharCode.apply(String,st);for(var dt="",vt=0;vt<ct;)dt+=String.fromCharCode.apply(String,st.slice(vt,vt+=4096));return dt}(I)}D.Buffer=u,D.SlowBuffer=function(t){return+t!=t&&(t=0),u.alloc(+t)},D.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=l.TYPED_ARRAY_SUPPORT!==void 0?l.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},t.foo()===42&&typeof t.subarray=="function"&&t.subarray(1,1).byteLength===0}catch{return!1}}(),D.kMaxLength=R(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,n,a){return A(null,t,n,a)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,typeof Symbol!="undefined"&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,n,a){return function(I,M,j,Y){return y(M),M<=0?b(I,M):j!==void 0?typeof Y=="string"?b(I,M).fill(j,Y):b(I,M).fill(j):b(I,M)}(null,t,n,a)},u.allocUnsafe=function(t){return f(null,t)},u.allocUnsafeSlow=function(t){return f(null,t)},u.isBuffer=function(t){return!(t==null||!t._isBuffer)},u.compare=function(t,n){if(!u.isBuffer(t)||!u.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(t===n)return 0;for(var a=t.length,I=n.length,M=0,j=Math.min(a,I);M<j;++M)if(t[M]!==n[M]){a=t[M],I=n[M];break}return a<I?-1:I<a?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,n){if(!w(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return u.alloc(0);var a;if(n===void 0)for(n=0,a=0;a<t.length;++a)n+=t[a].length;var I=u.allocUnsafe(n),M=0;for(a=0;a<t.length;++a){var j=t[a];if(!u.isBuffer(j))throw new TypeError('"list" argument must be an Array of Buffers');j.copy(I,M),M+=j.length}return I},u.byteLength=h,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var n=0;n<t;n+=2)k(this,n,n+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var n=0;n<t;n+=4)k(this,n,n+3),k(this,n+1,n+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var n=0;n<t;n+=8)k(this,n,n+7),k(this,n+1,n+6),k(this,n+2,n+5),k(this,n+3,n+4);return this},u.prototype.toString=function(){var t=0|this.length;return t===0?"":arguments.length===0?B(this,0,t):C.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||u.compare(this,t)===0},u.prototype.inspect=function(){var t="",n=D.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,n,a,I,M){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(n===void 0&&(n=0),a===void 0&&(a=t?t.length:0),I===void 0&&(I=0),M===void 0&&(M=this.length),n<0||a>t.length||I<0||M>this.length)throw new RangeError("out of range index");if(I>=M&&n>=a)return 0;if(I>=M)return-1;if(n>=a)return 1;if(this===t)return 0;for(var j=(M>>>=0)-(I>>>=0),Y=(a>>>=0)-(n>>>=0),W=Math.min(j,Y),et=this.slice(I,M),Q=t.slice(n,a),$=0;$<W;++$)if(et[$]!==Q[$]){j=et[$],Y=Q[$];break}return j<Y?-1:Y<j?1:0},u.prototype.includes=function(t,n,a){return this.indexOf(t,n,a)!==-1},u.prototype.indexOf=function(t,n,a){return L(this,t,n,a,!0)},u.prototype.lastIndexOf=function(t,n,a){return L(this,t,n,a,!1)},u.prototype.write=function(t,n,a,I){if(n===void 0)I="utf8",a=this.length,n=0;else if(a===void 0&&typeof n=="string")I=n,a=this.length,n=0;else{if(!isFinite(n))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");n|=0,isFinite(a)?(a|=0,I===void 0&&(I="utf8")):(I=a,a=void 0)}var M=this.length-n;if((a===void 0||a>M)&&(a=M),t.length>0&&(a<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");I||(I="utf8");for(var j=!1;;)switch(I){case"hex":return e(this,t,n,a);case"utf8":case"utf-8":return s(this,t,n,a);case"ascii":return i(this,t,n,a);case"latin1":case"binary":return _(this,t,n,a);case"base64":return d(this,t,n,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,n,a);default:if(j)throw new TypeError("Unknown encoding: "+I);I=(""+I).toLowerCase(),j=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function U(t,n,a){var I="";a=Math.min(t.length,a);for(var M=n;M<a;++M)I+=String.fromCharCode(127&t[M]);return I}function P(t,n,a){var I="";a=Math.min(t.length,a);for(var M=n;M<a;++M)I+=String.fromCharCode(t[M]);return I}function N(t,n,a){var I=t.length;(!n||n<0)&&(n=0),(!a||a<0||a>I)&&(a=I);for(var M="",j=n;j<a;++j)M+=X(t[j]);return M}function r(t,n,a){for(var I=t.slice(n,a),M="",j=0;j<I.length;j+=2)M+=String.fromCharCode(I[j]+256*I[j+1]);return M}function o(t,n,a){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+n>a)throw new RangeError("Trying to access beyond buffer length")}function v(t,n,a,I,M,j){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>M||n<j)throw new RangeError('"value" argument is out of bounds');if(a+I>t.length)throw new RangeError("Index out of range")}function T(t,n,a,I){n<0&&(n=65535+n+1);for(var M=0,j=Math.min(t.length-a,2);M<j;++M)t[a+M]=(n&255<<8*(I?M:1-M))>>>8*(I?M:1-M)}function x(t,n,a,I){n<0&&(n=4294967295+n+1);for(var M=0,j=Math.min(t.length-a,4);M<j;++M)t[a+M]=n>>>8*(I?M:3-M)&255}function H(t,n,a,I,M,j){if(a+I>t.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("Index out of range")}function J(t,n,a,I,M){return M||H(t,0,a,4),g.write(t,n,a,I,23,4),a+4}function G(t,n,a,I,M){return M||H(t,0,a,8),g.write(t,n,a,I,52,8),a+8}u.prototype.slice=function(t,n){var a,I=this.length;if((t=~~t)<0?(t+=I)<0&&(t=0):t>I&&(t=I),(n=n===void 0?I:~~n)<0?(n+=I)<0&&(n=0):n>I&&(n=I),n<t&&(n=t),u.TYPED_ARRAY_SUPPORT)(a=this.subarray(t,n)).__proto__=u.prototype;else{var M=n-t;a=new u(M,void 0);for(var j=0;j<M;++j)a[j]=this[j+t]}return a},u.prototype.readUIntLE=function(t,n,a){t|=0,n|=0,a||o(t,n,this.length);for(var I=this[t],M=1,j=0;++j<n&&(M*=256);)I+=this[t+j]*M;return I},u.prototype.readUIntBE=function(t,n,a){t|=0,n|=0,a||o(t,n,this.length);for(var I=this[t+--n],M=1;n>0&&(M*=256);)I+=this[t+--n]*M;return I},u.prototype.readUInt8=function(t,n){return n||o(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,n){return n||o(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,n){return n||o(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,n){return n||o(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,n){return n||o(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,n,a){t|=0,n|=0,a||o(t,n,this.length);for(var I=this[t],M=1,j=0;++j<n&&(M*=256);)I+=this[t+j]*M;return I>=(M*=128)&&(I-=Math.pow(2,8*n)),I},u.prototype.readIntBE=function(t,n,a){t|=0,n|=0,a||o(t,n,this.length);for(var I=n,M=1,j=this[t+--I];I>0&&(M*=256);)j+=this[t+--I]*M;return j>=(M*=128)&&(j-=Math.pow(2,8*n)),j},u.prototype.readInt8=function(t,n){return n||o(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,n){n||o(t,2,this.length);var a=this[t]|this[t+1]<<8;return 32768&a?4294901760|a:a},u.prototype.readInt16BE=function(t,n){n||o(t,2,this.length);var a=this[t+1]|this[t]<<8;return 32768&a?4294901760|a:a},u.prototype.readInt32LE=function(t,n){return n||o(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,n){return n||o(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,n){return n||o(t,4,this.length),g.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,n){return n||o(t,4,this.length),g.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,n){return n||o(t,8,this.length),g.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,n){return n||o(t,8,this.length),g.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,n,a,I){t=+t,n|=0,a|=0,I||v(this,t,n,a,Math.pow(2,8*a)-1,0);var M=1,j=0;for(this[n]=255&t;++j<a&&(M*=256);)this[n+j]=t/M&255;return n+a},u.prototype.writeUIntBE=function(t,n,a,I){t=+t,n|=0,a|=0,I||v(this,t,n,a,Math.pow(2,8*a)-1,0);var M=a-1,j=1;for(this[n+M]=255&t;--M>=0&&(j*=256);)this[n+M]=t/j&255;return n+a},u.prototype.writeUInt8=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[n]=255&t,n+1},u.prototype.writeUInt16LE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):T(this,t,n,!0),n+2},u.prototype.writeUInt16BE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):T(this,t,n,!1),n+2},u.prototype.writeUInt32LE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=255&t):x(this,t,n,!0),n+4},u.prototype.writeUInt32BE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):x(this,t,n,!1),n+4},u.prototype.writeIntLE=function(t,n,a,I){if(t=+t,n|=0,!I){var M=Math.pow(2,8*a-1);v(this,t,n,a,M-1,-M)}var j=0,Y=1,W=0;for(this[n]=255&t;++j<a&&(Y*=256);)t<0&&W===0&&this[n+j-1]!==0&&(W=1),this[n+j]=(t/Y>>0)-W&255;return n+a},u.prototype.writeIntBE=function(t,n,a,I){if(t=+t,n|=0,!I){var M=Math.pow(2,8*a-1);v(this,t,n,a,M-1,-M)}var j=a-1,Y=1,W=0;for(this[n+j]=255&t;--j>=0&&(Y*=256);)t<0&&W===0&&this[n+j+1]!==0&&(W=1),this[n+j]=(t/Y>>0)-W&255;return n+a},u.prototype.writeInt8=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[n]=255&t,n+1},u.prototype.writeInt16LE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):T(this,t,n,!0),n+2},u.prototype.writeInt16BE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):T(this,t,n,!1),n+2},u.prototype.writeInt32LE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24):x(this,t,n,!0),n+4},u.prototype.writeInt32BE=function(t,n,a){return t=+t,n|=0,a||v(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):x(this,t,n,!1),n+4},u.prototype.writeFloatLE=function(t,n,a){return J(this,t,n,!0,a)},u.prototype.writeFloatBE=function(t,n,a){return J(this,t,n,!1,a)},u.prototype.writeDoubleLE=function(t,n,a){return G(this,t,n,!0,a)},u.prototype.writeDoubleBE=function(t,n,a){return G(this,t,n,!1,a)},u.prototype.copy=function(t,n,a,I){if(a||(a=0),I||I===0||(I=this.length),n>=t.length&&(n=t.length),n||(n=0),I>0&&I<a&&(I=a),I===a||t.length===0||this.length===0)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("sourceStart out of bounds");if(I<0)throw new RangeError("sourceEnd out of bounds");I>this.length&&(I=this.length),t.length-n<I-a&&(I=t.length-n+a);var M,j=I-a;if(this===t&&a<n&&n<I)for(M=j-1;M>=0;--M)t[M+n]=this[M+a];else if(j<1e3||!u.TYPED_ARRAY_SUPPORT)for(M=0;M<j;++M)t[M+n]=this[M+a];else Uint8Array.prototype.set.call(t,this.subarray(a,a+j),n);return j},u.prototype.fill=function(t,n,a,I){if(typeof t=="string"){if(typeof n=="string"?(I=n,n=0,a=this.length):typeof a=="string"&&(I=a,a=this.length),t.length===1){var M=t.charCodeAt(0);M<256&&(t=M)}if(I!==void 0&&typeof I!="string")throw new TypeError("encoding must be a string");if(typeof I=="string"&&!u.isEncoding(I))throw new TypeError("Unknown encoding: "+I)}else typeof t=="number"&&(t&=255);if(n<0||this.length<n||this.length<a)throw new RangeError("Out of range index");if(a<=n)return this;var j;if(n>>>=0,a=a===void 0?this.length:a>>>0,t||(t=0),typeof t=="number")for(j=n;j<a;++j)this[j]=t;else{var Y=u.isBuffer(t)?t:rt(new u(t,I).toString()),W=Y.length;for(j=0;j<a-n;++j)this[j+n]=Y[j%W]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function X(t){return t<16?"0"+t.toString(16):t.toString(16)}function rt(t,n){var a;n=n||1/0;for(var I=t.length,M=null,j=[],Y=0;Y<I;++Y){if((a=t.charCodeAt(Y))>55295&&a<57344){if(!M){if(a>56319){(n-=3)>-1&&j.push(239,191,189);continue}if(Y+1===I){(n-=3)>-1&&j.push(239,191,189);continue}M=a;continue}if(a<56320){(n-=3)>-1&&j.push(239,191,189),M=a;continue}a=65536+(M-55296<<10|a-56320)}else M&&(n-=3)>-1&&j.push(239,191,189);if(M=null,a<128){if((n-=1)<0)break;j.push(a)}else if(a<2048){if((n-=2)<0)break;j.push(a>>6|192,63&a|128)}else if(a<65536){if((n-=3)<0)break;j.push(a>>12|224,a>>6&63|128,63&a|128)}else{if(!(a<1114112))throw new Error("Invalid code point");if((n-=4)<0)break;j.push(a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128)}}return j}function tt(t){return m.toByteArray(function(n){if((n=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}(n).replace(z,"")).length<2)return"";for(;n.length%4!=0;)n+="=";return n}(t))}function K(t,n,a,I){for(var M=0;M<I&&!(M+a>=n.length||M>=t.length);++M)n[M+a]=t[M];return M}}).call(this,E(5))},function(F,D,E){D.byteLength=function(y){var f=u(y),c=f[0],p=f[1];return 3*(c+p)/4-p},D.toByteArray=function(y){var f,c,p=u(y),h=p[0],C=p[1],k=new g(function(e,s,i){return 3*(s+i)/4-i}(0,h,C)),L=0,O=C>0?h-4:h;for(c=0;c<O;c+=4)f=m[y.charCodeAt(c)]<<18|m[y.charCodeAt(c+1)]<<12|m[y.charCodeAt(c+2)]<<6|m[y.charCodeAt(c+3)],k[L++]=f>>16&255,k[L++]=f>>8&255,k[L++]=255&f;return C===2&&(f=m[y.charCodeAt(c)]<<2|m[y.charCodeAt(c+1)]>>4,k[L++]=255&f),C===1&&(f=m[y.charCodeAt(c)]<<10|m[y.charCodeAt(c+1)]<<4|m[y.charCodeAt(c+2)]>>2,k[L++]=f>>8&255,k[L++]=255&f),k},D.fromByteArray=function(y){for(var f,c=y.length,p=c%3,h=[],C=0,k=c-p;C<k;C+=16383)h.push(A(y,C,C+16383>k?k:C+16383));return p===1?(f=y[c-1],h.push(l[f>>2]+l[f<<4&63]+"==")):p===2&&(f=(y[c-2]<<8)+y[c-1],h.push(l[f>>10]+l[f>>4&63]+l[f<<2&63]+"=")),h.join("")};for(var l=[],m=[],g=typeof Uint8Array!="undefined"?Uint8Array:Array,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=0,b=w.length;R<b;++R)l[R]=w[R],m[w.charCodeAt(R)]=R;function u(y){var f=y.length;if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=y.indexOf("=");return c===-1&&(c=f),[c,c===f?0:4-c%4]}function A(y,f,c){for(var p,h,C=[],k=f;k<c;k+=3)p=(y[k]<<16&16711680)+(y[k+1]<<8&65280)+(255&y[k+2]),C.push(l[(h=p)>>18&63]+l[h>>12&63]+l[h>>6&63]+l[63&h]);return C.join("")}m["-".charCodeAt(0)]=62,m["_".charCodeAt(0)]=63},function(F,D){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */D.read=function(E,l,m,g,w){var R,b,u=8*w-g-1,A=(1<<u)-1,y=A>>1,f=-7,c=m?w-1:0,p=m?-1:1,h=E[l+c];for(c+=p,R=h&(1<<-f)-1,h>>=-f,f+=u;f>0;R=256*R+E[l+c],c+=p,f-=8);for(b=R&(1<<-f)-1,R>>=-f,f+=g;f>0;b=256*b+E[l+c],c+=p,f-=8);if(R===0)R=1-y;else{if(R===A)return b?NaN:1/0*(h?-1:1);b+=Math.pow(2,g),R-=y}return(h?-1:1)*b*Math.pow(2,R-g)},D.write=function(E,l,m,g,w,R){var b,u,A,y=8*R-w-1,f=(1<<y)-1,c=f>>1,p=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=g?0:R-1,C=g?1:-1,k=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(u=isNaN(l)?1:0,b=f):(b=Math.floor(Math.log(l)/Math.LN2),l*(A=Math.pow(2,-b))<1&&(b--,A*=2),(l+=b+c>=1?p/A:p*Math.pow(2,1-c))*A>=2&&(b++,A/=2),b+c>=f?(u=0,b=f):b+c>=1?(u=(l*A-1)*Math.pow(2,w),b+=c):(u=l*Math.pow(2,c-1)*Math.pow(2,w),b=0));w>=8;E[m+h]=255&u,h+=C,u/=256,w-=8);for(b=b<<w|u,y+=w;y>0;E[m+h]=255&b,h+=C,b/=256,y-=8);E[m+h-C]|=128*k}},function(F,D){var E={}.toString;F.exports=Array.isArray||function(l){return E.call(l)=="[object Array]"}},function(F,D,E){var l,m,g;m=[],(g=typeof(l=function(){var w,R,b,u;Object.keys||(Object.keys=(w=Object.prototype.hasOwnProperty,R=!{toString:null}.propertyIsEnumerable("toString"),u=(b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(r){if(typeof r!="object"&&typeof r!="function"||r===null)throw new TypeError("Object.keys called on non-object");var o=[];for(var v in r)w.call(r,v)&&o.push(v);if(R)for(var T=0;T<u;T++)w.call(r,b[T])&&o.push(b[T]);return o})),Object.create||(Object.create=function(){function r(){}return function(o){if(arguments.length!==1)throw new Error("Object.create implementation only accepts one parameter.");return r.prototype=o,new r}}()),Array.isArray||(Array.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"}),Array.prototype.indexOf||(Array.prototype.indexOf=function(r){if(this===null)throw new TypeError;var o=Object(this),v=o.length>>>0;if(v===0)return-1;var T=0;if(arguments.length>1&&((T=Number(arguments[1]))!=T?T=0:T!==0&&T!==1/0&&T!==-1/0&&(T=(T>0||-1)*Math.floor(Math.abs(T)))),T>=v)return-1;for(var x=T>=0?T:Math.max(v-Math.abs(T),0);x<v;x++)if(x in o&&o[x]===r)return x;return-1}),Object.isFrozen||(Object.isFrozen=function(r){for(var o="tv4_test_frozen_key";r.hasOwnProperty(o);)o+=Math.random();try{return r[o]=!0,delete r[o],!1}catch{return!0}});var A={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},y={"*":!0};function f(r){return encodeURI(r).replace(/%25[0-9][0-9]/g,function(o){return"%"+o.substring(3)})}function c(r){var o="";A[r.charAt(0)]&&(o=r.charAt(0),r=r.substring(1));var v="",T="",x=!0,H=!1,J=!1;o==="+"?x=!1:o==="."?(T=".",v="."):o==="/"?(T="/",v="/"):o==="#"?(T="#",x=!1):o===";"?(T=";",v=";",H=!0,J=!0):o==="?"?(T="?",v="&",H=!0):o==="&"&&(T="&",v="&",H=!0);for(var G=[],z=r.split(","),X=[],rt={},tt=0;tt<z.length;tt++){var K=z[tt],t=null;if(K.indexOf(":")!==-1){var n=K.split(":");K=n[0],t=parseInt(n[1],10)}for(var a={};y[K.charAt(K.length-1)];)a[K.charAt(K.length-1)]=!0,K=K.substring(0,K.length-1);var I={truncate:t,name:K,suffices:a};X.push(I),rt[K]=I,G.push(K)}var M=function(j){for(var Y="",W=0,et=0;et<X.length;et++){var Q=X[et],$=j(Q.name);if($==null||Array.isArray($)&&$.length===0||typeof $=="object"&&Object.keys($).length===0)W++;else if(Y+=et===W?T:v||",",Array.isArray($)){H&&(Y+=Q.name+"=");for(var it=0;it<$.length;it++)it>0&&(Y+=Q.suffices["*"]&&v||",",Q.suffices["*"]&&H&&(Y+=Q.name+"=")),Y+=x?encodeURIComponent($[it]).replace(/!/g,"%21"):f($[it])}else if(typeof $=="object"){H&&!Q.suffices["*"]&&(Y+=Q.name+"=");var st=!0;for(var ct in $)st||(Y+=Q.suffices["*"]&&v||","),st=!1,Y+=x?encodeURIComponent(ct).replace(/!/g,"%21"):f(ct),Y+=Q.suffices["*"]?"=":",",Y+=x?encodeURIComponent($[ct]).replace(/!/g,"%21"):f($[ct])}else H&&(Y+=Q.name,J&&$===""||(Y+="=")),Q.truncate!=null&&($=$.substring(0,Q.truncate)),Y+=x?encodeURIComponent($).replace(/!/g,"%21"):f($)}return Y};return M.varNames=G,{prefix:T,substitution:M}}function p(r){if(!(this instanceof p))return new p(r);for(var o=r.split("{"),v=[o.shift()],T=[],x=[],H=[];o.length>0;){var J=o.shift(),G=J.split("}")[0],z=J.substring(G.length+1),X=c(G);x.push(X.substitution),T.push(X.prefix),v.push(z),H=H.concat(X.substitution.varNames)}this.fill=function(rt){for(var tt=v[0],K=0;K<x.length;K++)tt+=(0,x[K])(rt),tt+=v[K+1];return tt},this.varNames=H,this.template=r}p.prototype={toString:function(){return this.template},fillFromObject:function(r){return this.fill(function(o){return r[o]})}};var h=function(r,o,v,T,x){if(this.missing=[],this.missingMap={},this.formatValidators=r?Object.create(r.formatValidators):{},this.schemas=r?Object.create(r.schemas):{},this.collectMultiple=o,this.errors=[],this.handleError=o?this.collectError:this.returnError,T&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),x&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=v||_("en"),typeof this.errorReporter=="string")throw new Error("debug");if(this.definedKeywords={},r)for(var H in r.definedKeywords)this.definedKeywords[H]=r.definedKeywords[H].slice(0)};function C(r,o){if(r===o)return!0;if(r&&o&&typeof r=="object"&&typeof o=="object"){if(Array.isArray(r)!==Array.isArray(o))return!1;if(Array.isArray(r)){if(r.length!==o.length)return!1;for(var v=0;v<r.length;v++)if(!C(r[v],o[v]))return!1}else{var T;for(T in r)if(o[T]===void 0&&r[T]!==void 0)return!1;for(T in o)if(r[T]===void 0&&o[T]!==void 0)return!1;for(T in r)if(!C(r[T],o[T]))return!1}return!0}return!1}h.prototype.defineKeyword=function(r,o){this.definedKeywords[r]=this.definedKeywords[r]||[],this.definedKeywords[r].push(o)},h.prototype.createError=function(r,o,v,T,x,H,J){var G=new U(r,o,v,T,x);return G.message=this.errorReporter(G,H,J),G},h.prototype.returnError=function(r){return r},h.prototype.collectError=function(r){return r&&this.errors.push(r),null},h.prototype.prefixErrors=function(r,o,v){for(var T=r;T<this.errors.length;T++)this.errors[T]=this.errors[T].prefixWith(o,v);return this},h.prototype.banUnknownProperties=function(r,o){for(var v in this.unknownPropertyPaths){var T=this.createError(d.UNKNOWN_PROPERTY,{path:v},v,"",null,r,o),x=this.handleError(T);if(x)return x}return null},h.prototype.addFormat=function(r,o){if(typeof r=="object"){for(var v in r)this.addFormat(v,r[v]);return this}this.formatValidators[r]=o},h.prototype.resolveRefs=function(r,o){if(r.$ref!==void 0){if((o=o||{})[r.$ref])return this.createError(d.CIRCULAR_REFERENCE,{urls:Object.keys(o).join(", ")},"","",null,void 0,r);o[r.$ref]=!0,r=this.getSchema(r.$ref,o)}return r},h.prototype.getSchema=function(r,o){var v;if(this.schemas[r]!==void 0)return v=this.schemas[r],this.resolveRefs(v,o);var T=r,x="";if(r.indexOf("#")!==-1&&(x=r.substring(r.indexOf("#")+1),T=r.substring(0,r.indexOf("#"))),typeof this.schemas[T]=="object"){v=this.schemas[T];var H=decodeURIComponent(x);if(H==="")return this.resolveRefs(v,o);if(H.charAt(0)!=="/")return;for(var J=H.split("/").slice(1),G=0;G<J.length;G++){var z=J[G].replace(/~1/g,"/").replace(/~0/g,"~");if(v[z]===void 0){v=void 0;break}v=v[z]}if(v!==void 0)return this.resolveRefs(v,o)}this.missing[T]===void 0&&(this.missing.push(T),this.missing[T]=T,this.missingMap[T]=T)},h.prototype.searchSchemas=function(r,o){if(Array.isArray(r))for(var v=0;v<r.length;v++)this.searchSchemas(r[v],o);else if(r&&typeof r=="object"){for(var T in typeof r.id=="string"&&function(H,J){if(J.substring(0,H.length)===H){var G=J.substring(H.length);if(J.length>0&&J.charAt(H.length-1)==="/"||G.charAt(0)==="#"||G.charAt(0)==="?")return!0}return!1}(o,r.id)&&this.schemas[r.id]===void 0&&(this.schemas[r.id]=r),r)if(T!=="enum"){if(typeof r[T]=="object")this.searchSchemas(r[T],o);else if(T==="$ref"){var x=s(r[T]);x&&this.schemas[x]===void 0&&this.missingMap[x]===void 0&&(this.missingMap[x]=x)}}}},h.prototype.addSchema=function(r,o){if(typeof r!="string"||o===void 0){if(typeof r!="object"||typeof r.id!="string")return;r=(o=r).id}r===s(r)+"#"&&(r=s(r)),this.schemas[r]=o,delete this.missingMap[r],i(o,r),this.searchSchemas(o,r)},h.prototype.getSchemaMap=function(){var r={};for(var o in this.schemas)r[o]=this.schemas[o];return r},h.prototype.getSchemaUris=function(r){var o=[];for(var v in this.schemas)r&&!r.test(v)||o.push(v);return o},h.prototype.getMissingUris=function(r){var o=[];for(var v in this.missingMap)r&&!r.test(v)||o.push(v);return o},h.prototype.dropSchemas=function(){this.schemas={},this.reset()},h.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},h.prototype.validateAll=function(r,o,v,T,x){var H;if(!(o=this.resolveRefs(o)))return null;if(o instanceof U)return this.errors.push(o),o;var J,G=this.errors.length,z=null,X=null;if(this.checkRecursive&&r&&typeof r=="object"){if(H=!this.scanned.length,r[this.validatedSchemasKey]){var rt=r[this.validatedSchemasKey].indexOf(o);if(rt!==-1)return this.errors=this.errors.concat(r[this.validationErrorsKey][rt]),null}if(Object.isFrozen(r)&&(J=this.scannedFrozen.indexOf(r))!==-1){var tt=this.scannedFrozenSchemas[J].indexOf(o);if(tt!==-1)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[J][tt]),null}if(this.scanned.push(r),Object.isFrozen(r))J===-1&&(J=this.scannedFrozen.length,this.scannedFrozen.push(r),this.scannedFrozenSchemas.push([])),z=this.scannedFrozenSchemas[J].length,this.scannedFrozenSchemas[J][z]=o,this.scannedFrozenValidationErrors[J][z]=[];else{if(!r[this.validatedSchemasKey])try{Object.defineProperty(r,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(r,this.validationErrorsKey,{value:[],configurable:!0})}catch{r[this.validatedSchemasKey]=[],r[this.validationErrorsKey]=[]}X=r[this.validatedSchemasKey].length,r[this.validatedSchemasKey][X]=o,r[this.validationErrorsKey][X]=[]}}var K=this.errors.length,t=this.validateBasic(r,o,x)||this.validateNumeric(r,o,x)||this.validateString(r,o,x)||this.validateArray(r,o,x)||this.validateObject(r,o,x)||this.validateCombinations(r,o,x)||this.validateHypermedia(r,o,x)||this.validateFormat(r,o,x)||this.validateDefinedKeywords(r,o,x)||null;if(H){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(t||K!==this.errors.length)for(;v&&v.length||T&&T.length;){var n=v&&v.length?""+v.pop():null,a=T&&T.length?""+T.pop():null;t&&(t=t.prefixWith(n,a)),this.prefixErrors(K,n,a)}return z!==null?this.scannedFrozenValidationErrors[J][z]=this.errors.slice(G):X!==null&&(r[this.validationErrorsKey][X]=this.errors.slice(G)),this.handleError(t)},h.prototype.validateFormat=function(r,o){if(typeof o.format!="string"||!this.formatValidators[o.format])return null;var v=this.formatValidators[o.format].call(null,r,o);return typeof v=="string"||typeof v=="number"?this.createError(d.FORMAT_CUSTOM,{message:v},"","/format",null,r,o):v&&typeof v=="object"?this.createError(d.FORMAT_CUSTOM,{message:v.message||"?"},v.dataPath||"",v.schemaPath||"/format",null,r,o):null},h.prototype.validateDefinedKeywords=function(r,o,v){for(var T in this.definedKeywords)if(o[T]!==void 0)for(var x=this.definedKeywords[T],H=0;H<x.length;H++){var J=(0,x[H])(r,o[T],o,v);if(typeof J=="string"||typeof J=="number")return this.createError(d.KEYWORD_CUSTOM,{key:T,message:J},"","",null,r,o).prefixWith(null,T);if(J&&typeof J=="object"){var G=J.code;if(typeof G=="string"){if(!d[G])throw new Error("Undefined error code (use defineError): "+G);G=d[G]}else typeof G!="number"&&(G=d.KEYWORD_CUSTOM);var z=typeof J.message=="object"?J.message:{key:T,message:J.message||"?"},X=J.schemaPath||"/"+T.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(G,z,J.dataPath||null,X,null,r,o)}}return null},h.prototype.validateBasic=function(r,o,v){var T;return(T=this.validateType(r,o,v))||(T=this.validateEnum(r,o,v))?T.prefixWith(null,"type"):null},h.prototype.validateType=function(r,o){if(o.type===void 0)return null;var v=typeof r;r===null?v="null":Array.isArray(r)&&(v="array");var T=o.type;Array.isArray(T)||(T=[T]);for(var x=0;x<T.length;x++){var H=T[x];if(H===v||H==="integer"&&v==="number"&&r%1==0)return null}return this.createError(d.INVALID_TYPE,{type:v,expected:T.join("/")},"","",null,r,o)},h.prototype.validateEnum=function(r,o){if(o.enum===void 0)return null;for(var v=0;v<o.enum.length;v++)if(C(r,o.enum[v]))return null;return this.createError(d.ENUM_MISMATCH,{value:typeof JSON!="undefined"?JSON.stringify(r):r},"","",null,r,o)},h.prototype.validateNumeric=function(r,o,v){return this.validateMultipleOf(r,o,v)||this.validateMinMax(r,o,v)||this.validateNaN(r,o,v)||null};var k=Math.pow(2,-51),L=1-k;function O(r){var o=String(r).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return o?{href:o[0]||"",protocol:o[1]||"",authority:o[2]||"",host:o[3]||"",hostname:o[4]||"",port:o[5]||"",pathname:o[6]||"",search:o[7]||"",hash:o[8]||""}:null}function e(r,o){return o=O(o||""),r=O(r||""),o&&r?(o.protocol||r.protocol)+(o.protocol||o.authority?o.authority:r.authority)+(v=o.protocol||o.authority||o.pathname.charAt(0)==="/"?o.pathname:o.pathname?(r.authority&&!r.pathname?"/":"")+r.pathname.slice(0,r.pathname.lastIndexOf("/")+1)+o.pathname:r.pathname,T=[],v.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(x){x==="/.."?T.pop():T.push(x)}),T.join("").replace(/^\//,v.charAt(0)==="/"?"/":""))+(o.protocol||o.authority||o.pathname?o.search:o.search||r.search)+o.hash:null;var v,T}function s(r){return r.split("#")[0]}function i(r,o){if(r&&typeof r=="object")if(o===void 0?o=r.id:typeof r.id=="string"&&(o=e(o,r.id),r.id=o),Array.isArray(r))for(var v=0;v<r.length;v++)i(r[v],o);else for(var T in typeof r.$ref=="string"&&(r.$ref=e(o,r.$ref)),r)T!=="enum"&&i(r[T],o)}function _(r){var o=P[r=r||"en"];return function(v){var T=o[v.code]||B[v.code];if(typeof T!="string")return"Unknown error code "+v.code+": "+JSON.stringify(v.messageParams);var x=v.params;return T.replace(/\{([^{}]*)\}/g,function(H,J){var G=x[J];return typeof G=="string"||typeof G=="number"?G:H})}}h.prototype.validateMultipleOf=function(r,o){var v=o.multipleOf||o.divisibleBy;if(v===void 0)return null;if(typeof r=="number"){var T=r/v%1;if(T>=k&&T<L)return this.createError(d.NUMBER_MULTIPLE_OF,{value:r,multipleOf:v},"","",null,r,o)}return null},h.prototype.validateMinMax=function(r,o){if(typeof r!="number")return null;if(o.minimum!==void 0){if(r<o.minimum)return this.createError(d.NUMBER_MINIMUM,{value:r,minimum:o.minimum},"","/minimum",null,r,o);if(o.exclusiveMinimum&&r===o.minimum)return this.createError(d.NUMBER_MINIMUM_EXCLUSIVE,{value:r,minimum:o.minimum},"","/exclusiveMinimum",null,r,o)}if(o.maximum!==void 0){if(r>o.maximum)return this.createError(d.NUMBER_MAXIMUM,{value:r,maximum:o.maximum},"","/maximum",null,r,o);if(o.exclusiveMaximum&&r===o.maximum)return this.createError(d.NUMBER_MAXIMUM_EXCLUSIVE,{value:r,maximum:o.maximum},"","/exclusiveMaximum",null,r,o)}return null},h.prototype.validateNaN=function(r,o){return typeof r!="number"?null:isNaN(r)===!0||r===1/0||r===-1/0?this.createError(d.NUMBER_NOT_A_NUMBER,{value:r},"","/type",null,r,o):null},h.prototype.validateString=function(r,o,v){return this.validateStringLength(r,o,v)||this.validateStringPattern(r,o,v)||null},h.prototype.validateStringLength=function(r,o){return typeof r!="string"?null:o.minLength!==void 0&&r.length<o.minLength?this.createError(d.STRING_LENGTH_SHORT,{length:r.length,minimum:o.minLength},"","/minLength",null,r,o):o.maxLength!==void 0&&r.length>o.maxLength?this.createError(d.STRING_LENGTH_LONG,{length:r.length,maximum:o.maxLength},"","/maxLength",null,r,o):null},h.prototype.validateStringPattern=function(r,o){if(typeof r!="string"||typeof o.pattern!="string"&&!(o.pattern instanceof RegExp))return null;var v;if(o.pattern instanceof RegExp)v=o.pattern;else{var T,x="",H=o.pattern.match(/^\/(.+)\/([img]*)$/);H?(T=H[1],x=H[2]):T=o.pattern,v=new RegExp(T,x)}return v.test(r)?null:this.createError(d.STRING_PATTERN,{pattern:o.pattern},"","/pattern",null,r,o)},h.prototype.validateArray=function(r,o,v){return Array.isArray(r)&&(this.validateArrayLength(r,o,v)||this.validateArrayUniqueItems(r,o,v)||this.validateArrayItems(r,o,v))||null},h.prototype.validateArrayLength=function(r,o){var v;return o.minItems!==void 0&&r.length<o.minItems&&(v=this.createError(d.ARRAY_LENGTH_SHORT,{length:r.length,minimum:o.minItems},"","/minItems",null,r,o),this.handleError(v))||o.maxItems!==void 0&&r.length>o.maxItems&&(v=this.createError(d.ARRAY_LENGTH_LONG,{length:r.length,maximum:o.maxItems},"","/maxItems",null,r,o),this.handleError(v))?v:null},h.prototype.validateArrayUniqueItems=function(r,o){if(o.uniqueItems){for(var v=0;v<r.length;v++)for(var T=v+1;T<r.length;T++)if(C(r[v],r[T])){var x=this.createError(d.ARRAY_UNIQUE,{match1:v,match2:T},"","/uniqueItems",null,r,o);if(this.handleError(x))return x}}return null},h.prototype.validateArrayItems=function(r,o,v){if(o.items===void 0)return null;var T,x;if(Array.isArray(o.items)){for(x=0;x<r.length;x++)if(x<o.items.length){if(T=this.validateAll(r[x],o.items[x],[x],["items",x],v+"/"+x))return T}else if(o.additionalItems!==void 0){if(typeof o.additionalItems=="boolean"){if(!o.additionalItems&&(T=this.createError(d.ARRAY_ADDITIONAL_ITEMS,{},"/"+x,"/additionalItems",null,r,o),this.handleError(T)))return T}else if(T=this.validateAll(r[x],o.additionalItems,[x],["additionalItems"],v+"/"+x))return T}}else for(x=0;x<r.length;x++)if(T=this.validateAll(r[x],o.items,[x],["items"],v+"/"+x))return T;return null},h.prototype.validateObject=function(r,o,v){return typeof r!="object"||r===null||Array.isArray(r)?null:this.validateObjectMinMaxProperties(r,o,v)||this.validateObjectRequiredProperties(r,o,v)||this.validateObjectProperties(r,o,v)||this.validateObjectDependencies(r,o,v)||null},h.prototype.validateObjectMinMaxProperties=function(r,o){var v,T=Object.keys(r);return o.minProperties!==void 0&&T.length<o.minProperties&&(v=this.createError(d.OBJECT_PROPERTIES_MINIMUM,{propertyCount:T.length,minimum:o.minProperties},"","/minProperties",null,r,o),this.handleError(v))||o.maxProperties!==void 0&&T.length>o.maxProperties&&(v=this.createError(d.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:T.length,maximum:o.maxProperties},"","/maxProperties",null,r,o),this.handleError(v))?v:null},h.prototype.validateObjectRequiredProperties=function(r,o){if(o.required!==void 0)for(var v=0;v<o.required.length;v++){var T=o.required[v];if(r[T]===void 0){var x=this.createError(d.OBJECT_REQUIRED,{key:T},"","/required/"+v,null,r,o);if(this.handleError(x))return x}}return null},h.prototype.validateObjectProperties=function(r,o,v){var T;for(var x in r){var H=v+"/"+x.replace(/~/g,"~0").replace(/\//g,"~1"),J=!1;if(o.properties!==void 0&&o.properties[x]!==void 0&&(J=!0,T=this.validateAll(r[x],o.properties[x],[x],["properties",x],H)))return T;if(o.patternProperties!==void 0){for(var G in o.patternProperties)if(new RegExp(G).test(x)&&(J=!0,T=this.validateAll(r[x],o.patternProperties[G],[x],["patternProperties",G],H)))return T}if(J)this.trackUnknownProperties&&(this.knownPropertyPaths[H]=!0,delete this.unknownPropertyPaths[H]);else if(o.additionalProperties!==void 0){if(this.trackUnknownProperties&&(this.knownPropertyPaths[H]=!0,delete this.unknownPropertyPaths[H]),typeof o.additionalProperties=="boolean"){if(!o.additionalProperties&&(T=this.createError(d.OBJECT_ADDITIONAL_PROPERTIES,{key:x},"","/additionalProperties",null,r,o).prefixWith(x,null),this.handleError(T)))return T}else if(T=this.validateAll(r[x],o.additionalProperties,[x],["additionalProperties"],H))return T}else this.trackUnknownProperties&&!this.knownPropertyPaths[H]&&(this.unknownPropertyPaths[H]=!0)}return null},h.prototype.validateObjectDependencies=function(r,o,v){var T;if(o.dependencies!==void 0){for(var x in o.dependencies)if(r[x]!==void 0){var H=o.dependencies[x];if(typeof H=="string"){if(r[H]===void 0&&(T=this.createError(d.OBJECT_DEPENDENCY_KEY,{key:x,missing:H},"","",null,r,o).prefixWith(null,x).prefixWith(null,"dependencies"),this.handleError(T)))return T}else if(Array.isArray(H))for(var J=0;J<H.length;J++){var G=H[J];if(r[G]===void 0&&(T=this.createError(d.OBJECT_DEPENDENCY_KEY,{key:x,missing:G},"","/"+J,null,r,o).prefixWith(null,x).prefixWith(null,"dependencies"),this.handleError(T)))return T}else if(T=this.validateAll(r,H,[],["dependencies",x],v))return T}}return null},h.prototype.validateCombinations=function(r,o,v){return this.validateAllOf(r,o,v)||this.validateAnyOf(r,o,v)||this.validateOneOf(r,o,v)||this.validateNot(r,o,v)||null},h.prototype.validateAllOf=function(r,o,v){if(o.allOf===void 0)return null;for(var T,x=0;x<o.allOf.length;x++){var H=o.allOf[x];if(T=this.validateAll(r,H,[],["allOf",x],v))return T}return null},h.prototype.validateAnyOf=function(r,o,v){if(o.anyOf===void 0)return null;var T,x,H=[],J=this.errors.length;this.trackUnknownProperties&&(T=this.unknownPropertyPaths,x=this.knownPropertyPaths);for(var G=!0,z=0;z<o.anyOf.length;z++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var X=o.anyOf[z],rt=this.errors.length,tt=this.validateAll(r,X,[],["anyOf",z],v);if(tt===null&&rt===this.errors.length){if(this.errors=this.errors.slice(0,J),this.trackUnknownProperties){for(var K in this.knownPropertyPaths)x[K]=!0,delete T[K];for(var t in this.unknownPropertyPaths)x[t]||(T[t]=!0);G=!1;continue}return null}tt&&H.push(tt.prefixWith(null,""+z).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=T,this.knownPropertyPaths=x),G?(H=H.concat(this.errors.slice(J)),this.errors=this.errors.slice(0,J),this.createError(d.ANY_OF_MISSING,{},"","/anyOf",H,r,o)):void 0},h.prototype.validateOneOf=function(r,o,v){if(o.oneOf===void 0)return null;var T,x,H=null,J=[],G=this.errors.length;this.trackUnknownProperties&&(T=this.unknownPropertyPaths,x=this.knownPropertyPaths);for(var z=0;z<o.oneOf.length;z++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var X=o.oneOf[z],rt=this.errors.length,tt=this.validateAll(r,X,[],["oneOf",z],v);if(tt===null&&rt===this.errors.length){if(H!==null)return this.errors=this.errors.slice(0,G),this.createError(d.ONE_OF_MULTIPLE,{index1:H,index2:z},"","/oneOf",null,r,o);if(H=z,this.trackUnknownProperties){for(var K in this.knownPropertyPaths)x[K]=!0,delete T[K];for(var t in this.unknownPropertyPaths)x[t]||(T[t]=!0)}}else tt&&J.push(tt)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=T,this.knownPropertyPaths=x),H===null?(J=J.concat(this.errors.slice(G)),this.errors=this.errors.slice(0,G),this.createError(d.ONE_OF_MISSING,{},"","/oneOf",J,r,o)):(this.errors=this.errors.slice(0,G),null)},h.prototype.validateNot=function(r,o,v){if(o.not===void 0)return null;var T,x,H=this.errors.length;this.trackUnknownProperties&&(T=this.unknownPropertyPaths,x=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var J=this.validateAll(r,o.not,null,null,v),G=this.errors.slice(H);return this.errors=this.errors.slice(0,H),this.trackUnknownProperties&&(this.unknownPropertyPaths=T,this.knownPropertyPaths=x),J===null&&G.length===0?this.createError(d.NOT_PASSED,{},"","/not",null,r,o):null},h.prototype.validateHypermedia=function(r,o,v){if(!o.links)return null;for(var T,x=0;x<o.links.length;x++){var H=o.links[x];if(H.rel==="describedby"){for(var J=new p(H.href),G=!0,z=0;z<J.varNames.length;z++)if(!(J.varNames[z]in r)){G=!1;break}if(G){var X={$ref:J.fillFromObject(r)};if(T=this.validateAll(r,X,[],["links",x],v))return T}}}};var d={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},S={};for(var q in d)S[d[q]]=q;var B={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function U(r,o,v,T,x){if(Error.call(this),r===void 0)throw new Error("No error code supplied: "+T);this.message="",this.params=o,this.code=r,this.dataPath=v||"",this.schemaPath=T||"",this.subErrors=x||null;var H=new Error(this.message);if(this.stack=H.stack||H.stacktrace,!this.stack)try{throw H}catch(J){this.stack=J.stack||J.stacktrace}}U.prototype=Object.create(Error.prototype),U.prototype.constructor=U,U.prototype.name="ValidationError",U.prototype.prefixWith=function(r,o){if(r!==null&&(r=r.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+r+this.dataPath),o!==null&&(o=o.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+o+this.schemaPath),this.subErrors!==null)for(var v=0;v<this.subErrors.length;v++)this.subErrors[v].prefixWith(r,o);return this};var P={},N=function r(o){var v,T,x=new h,H={setErrorReporter:function(J){return typeof J=="string"?this.language(J):(T=J,!0)},addFormat:function(){x.addFormat.apply(x,arguments)},language:function(J){return J?(P[J]||(J=J.split("-")[0]),!!P[J]&&(v=J,J)):v},addLanguage:function(J,G){var z;for(z in d)G[z]&&!G[d[z]]&&(G[d[z]]=G[z]);var X=J.split("-")[0];if(P[X])for(z in P[J]=Object.create(P[X]),G)P[X][z]===void 0&&(P[X][z]=G[z]),P[J][z]=G[z];else P[J]=G,P[X]=G;return this},freshApi:function(J){var G=r();return J&&G.language(J),G},validate:function(J,G,z,X){var rt=_(v),tt=new h(x,!1,T?function(t,n,a){return T(t,n,a)||rt(t,n,a)}:rt,z,X);typeof G=="string"&&(G={$ref:G}),tt.addSchema("",G);var K=tt.validateAll(J,G,null,null,"");return!K&&X&&(K=tt.banUnknownProperties(J,G)),this.error=K,this.missing=tt.missing,this.valid=K===null,this.valid},validateResult:function(){var J={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(J,arguments),J},validateMultiple:function(J,G,z,X){var rt=_(v),tt=new h(x,!0,T?function(t,n,a){return T(t,n,a)||rt(t,n,a)}:rt,z,X);typeof G=="string"&&(G={$ref:G}),tt.addSchema("",G),tt.validateAll(J,G,null,null,""),X&&tt.banUnknownProperties(J,G);var K={toString:function(){return this.valid?"valid":this.error.message}};return K.errors=tt.errors,K.missing=tt.missing,K.valid=K.errors.length===0,K},addSchema:function(){return x.addSchema.apply(x,arguments)},getSchema:function(){return x.getSchema.apply(x,arguments)},getSchemaMap:function(){return x.getSchemaMap.apply(x,arguments)},getSchemaUris:function(){return x.getSchemaUris.apply(x,arguments)},getMissingUris:function(){return x.getMissingUris.apply(x,arguments)},dropSchemas:function(){x.dropSchemas.apply(x,arguments)},defineKeyword:function(){x.defineKeyword.apply(x,arguments)},defineError:function(J,G,z){if(typeof J!="string"||!/^[A-Z]+(_[A-Z]+)*$/.test(J))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if(typeof G!="number"||G%1!=0||G<1e4)throw new Error("Code number must be an integer > 10000");if(d[J]!==void 0)throw new Error("Error already defined: "+J+" as "+d[J]);if(S[G]!==void 0)throw new Error("Error code already used: "+S[G]+" as "+G);for(var X in d[J]=G,S[G]=J,B[J]=B[G]=z,P){var rt=P[X];rt[J]&&(rt[G]=rt[G]||rt[J])}},reset:function(){x.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:i,resolveUrl:e,getDocumentUri:s,errorCodes:d};return H.language(o||"en"),H}();return N.addLanguage("en-gb",B),N.tv4=N,N})=="function"?l.apply(D,m):l)===void 0||(F.exports=g)},function(F,D,E){Object.defineProperty(D,"__esModule",{value:!0}),D.BaseClientTypes=void 0;class l{constructor(){this.uris={},this.schemas={},this.aliases={}}declare(w,R,b,u){const A=w+"/"+R;if(u.extends){const y=u.extends.split("/"),f=y.length===1?w+"/"+y.shift():y.join("/"),c=this.uris[f];if(!c)throw"Type '"+A+"' tries to extend unknown schema '"+f+"'";u.extends=this.schemas[c]}this.uris[A]=b,this.aliases[b]=A,this.schemas[b]=u}resolveAlias(w){return this.uris[w]}getSchema(w){return this.schemas[w]}inScope(w){const R=w.length,b={};for(const u in this.uris)if(u.substr(0,R+1)===w+"/"){const A=this.uris[u];b[A]=this.schemas[A]}return b}}D.BaseClientTypes=l;const m=new l;D.default=m},function(F,D,E){class l extends Error{constructor(g){super();const w=new Error("Schema not found: "+g);return w.name="SchemaNotFound",w}}F.exports=l},function(F,D,E){F.exports=class{constructor(l){this._itemsRev={},this._storage={},this._canPropagate=!1,this.defaultValue=l,this.activatePropagation()}get(l){l=l.toLowerCase();let m=this._storage[l];return m===void 0&&(m=this.defaultValue,this._storage[l]=m),m}set(l,m){return l=l.toLowerCase(),this._storage[l]===m||(this._storage[l]=m,m||delete this._itemsRev[l],this._updateParentFolderItemRev(l,m),this._canPropagate&&this._propagate(l)),m}delete(l){return this.set(l,null)}deactivatePropagation(){return this._canPropagate=!1,!0}activatePropagation(){return this._canPropagate||(this._generateFolderRev("/"),this._canPropagate=!0),!0}_hashCode(l){let m=0;if(l.length===0)return m;for(let g=0;g<l.length;g++)m=(m<<5)-m+l.charCodeAt(g),m|=0;return m}_generateHash(l){const m=l.sort().join("|");return""+this._hashCode(m)}_updateParentFolderItemRev(l,m){if(l!=="/"){const g=this._getParentFolder(l);this._itemsRev[g]||(this._itemsRev[g]={});const w=this._itemsRev[g];m?w[l]=m:delete w[l],this._updateParentFolderItemRev(g,this.defaultValue)}}_getParentFolder(l){return l.substr(0,l.lastIndexOf("/",l.length-2)+1)}_propagate(l){if(l!=="/"){const m=this._getParentFolder(l),g=this._itemsRev[m],w=[];for(const b in g)w.push(g[b]);const R=this._generateHash(w);this.set(m,R)}}_generateFolderRev(l){const m=this._itemsRev[l];let g=this.defaultValue;if(m){const w=[];for(const R in m){let b;b=R.substr(-1)==="/"?this._generateFolderRev(R):m[R],w.push(b)}w.length>0&&(g=this._generateHash(w))}return this.set(l,g),g}}},function(F,D,E){var l;/*!
 * webfinger.js
 *   version 2.7.0
 *   http://github.com/silverbucket/webfinger.js
 *
 * Developed and Maintained by:
 *   Nick Jennings <nick@silverbucket.net> 2012
 *
 * webfinger.js is released under the AGPL (see LICENSE).
 *
 * You don't have to do anything special to choose one license or the other and you don't
 * have to notify anyone which license you are using.
 * Please see the corresponding license file for details of these licenses.
 * You are free to use, modify and distribute this software, but all copyright
 * information must remain.
 *
 */typeof fetch!="function"&&typeof XMLHttpRequest!="function"&&(XMLHttpRequest=E(28)),function(m){var g={"http://webfist.org/spec/rel":"webfist","http://webfinger.net/rel/avatar":"avatar",remotestorage:"remotestorage","http://tools.ietf.org/id/draft-dejong-remotestorage":"remotestorage",remoteStorage:"remotestorage","http://www.packetizer.com/rel/share":"share","http://webfinger.net/rel/profile-page":"profile",me:"profile",vcard:"vcard",blog:"blog","http://packetizer.com/rel/blog":"blog","http://schemas.google.com/g/2010#updates-from":"updates","https://camlistore.org/rel/server":"camilstore"},w={avatar:[],remotestorage:[],blog:[],vcard:[],updates:[],share:[],profile:[],webfist:[],camlistore:[]},R=["webfinger","host-meta","host-meta.json"];function b(A){return A.toString=function(){return this.message},A}function u(A){typeof A!="object"&&(A={}),this.config={tls_only:A.tls_only===void 0||A.tls_only,webfist_fallback:A.webfist_fallback!==void 0&&A.webfist_fallback,uri_fallback:A.uri_fallback!==void 0&&A.uri_fallback,request_timeout:A.request_timeout!==void 0?A.request_timeout:1e4}}u.prototype.__fetchJRD=function(A,y,f){if(typeof fetch=="function")return this.__fetchJRD_fetch(A,y,f);if(typeof XMLHttpRequest=="function")return this.__fetchJRD_XHR(A,y,f);throw new Error("add a polyfill for fetch or XMLHttpRequest")},u.prototype.__fetchJRD_fetch=function(A,y,f){var c,p=this;typeof AbortController=="function"&&(c=new AbortController);var h=fetch(A,{headers:{Accept:"application/jrd+json, application/json"},signal:c?c.signal:void 0}).then(function(k){if(k.ok)return k.text();throw k.status===404?b({message:"resource not found",url:A,status:k.status}):b({message:"error during request",url:A,status:k.status})},function(k){throw b({message:"error during request",url:A,status:void 0,err:k})}).then(function(k){if(p.__isValidJSON(k))return k;throw b({message:"invalid json",url:A,status:void 0})}),C=new Promise(function(k,L){setTimeout(function(){L(b({message:"request timed out",url:A,status:void 0})),c&&c.abort()},p.config.request_timeout)});Promise.race([h,C]).then(function(k){f(k)}).catch(function(k){y(k)})},u.prototype.__fetchJRD_XHR=function(A,y,f){var c=this,p=!1,h=new XMLHttpRequest;function C(){if(!p){if(p=!0,h.status===200)return c.__isValidJSON(h.responseText)?f(h.responseText):y(b({message:"invalid json",url:A,status:h.status}));if(h.status===404)return y(b({message:"resource not found",url:A,status:h.status}));if(h.status>=301&&h.status<=302){var L=h.getResponseHeader("Location");return function(O){return typeof O=="string"&&O.split("://")[0]==="https"}(L)?k():y(b({message:"no redirect URL found",url:A,status:h.status}))}return y(b({message:"error during request",url:A,status:h.status}))}}function k(){h.onreadystatechange=function(){h.readyState===4&&C()},h.onload=function(){C()},h.ontimeout=function(){return y(b({message:"request timed out",url:A,status:h.status}))},h.open("GET",A,!0),h.timeout=c.config.request_timeout,h.setRequestHeader("Accept","application/jrd+json, application/json"),h.send()}return k()},u.prototype.__isValidJSON=function(A){try{JSON.parse(A)}catch{return!1}return!0},u.prototype.__isLocalhost=function(A){return/^localhost(\.localdomain)?(\:[0-9]+)?$/.test(A)},u.prototype.__processJRD=function(A,y,f,c){var p=JSON.parse(y);if(typeof p!="object"||typeof p.links!="object")return p.error!==void 0?f(b({message:p.error,request:A})):f(b({message:"unknown response from server",request:A}));var h=p.links;Array.isArray(h)||(h=[]);var C={object:p,json:y,idx:{}};C.idx.properties={name:void 0},C.idx.links=JSON.parse(JSON.stringify(w)),h.map(function(O,e){if(g.hasOwnProperty(O.rel)&&C.idx.links[g[O.rel]]){var s={};Object.keys(O).map(function(i,_){s[i]=O[i]}),C.idx.links[g[O.rel]].push(s)}});var k=JSON.parse(y).properties;for(var L in k)k.hasOwnProperty(L)&&L==="http://packetizer.com/ns/name"&&(C.idx.properties.name=k[L]);return c(C)},u.prototype.lookup=function(A,y){if(typeof A!="string")throw new Error("first parameter must be a user address");if(typeof y!="function")throw new Error("second parameter must be a callback");var f=this,c="";c=A.indexOf("://")>-1?A.replace(/ /g,"").split("/")[2]:A.replace(/ /g,"").split("@")[1];var p=0,h="https";function C(){var O="";return A.split("://")[1]||(O="acct:"),h+"://"+c+"/.well-known/"+R[p]+"?resource="+O+A}function k(O){if(f.config.uri_fallback&&c!=="webfist.org"&&p!==R.length-1)return p+=1,L();if(!f.config.tls_only&&h==="https")return p=0,h="http",L();if(!f.config.webfist_fallback||c==="webfist.org")return y(O);p=0,h="http",c="webfist.org";var e=C();f.__fetchJRD(e,y,function(s){f.__processJRD(e,s,y,function(i){typeof i.idx.links.webfist=="object"&&typeof i.idx.links.webfist[0].href=="string"&&f.__fetchJRD(i.idx.links.webfist[0].href,y,function(_){f.__processJRD(e,_,y,function(d){return y(null,y)})})})})}function L(){var O=C();f.__fetchJRD(O,k,function(e){f.__processJRD(O,e,y,function(s){y(null,s)})})}return f.__isLocalhost(c)&&(h="http"),setTimeout(L,0)},u.prototype.lookupLink=function(A,y,f){if(!w.hasOwnProperty(y))return f("unsupported rel "+y);this.lookup(A,function(c,p){var h=p.idx.links[y];return c?f(c):h.length===0?f('no links found with rel="'+y+'"'):f(null,h[0])})},(l=function(){return u}.apply(D,[]))===void 0||(F.exports=l)}()},function(F,D){F.exports=XMLHttpRequest},function(F,D,E){var l=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};const m=l(E(3)),g=l(E(16)),w=l(E(1)),R=E(0),b=l(E(30)),u=l(E(11)),A=l(E(6)),y=l(E(15)),f=l(E(7)),c=l(E(13)),p=l(E(14)),h=l(E(8)),C=l(E(31)),k=l(E(12)),L=l(E(32)),O=l(E(33)),e=l(E(34)),s={features:[],featuresDone:0,readyFired:!1,loadFeatures(){this.features=[],this.featuresDone=0,this.readyFired=!1,this.featureModules={WireClient:h.default,Dropbox:p.default,GoogleDrive:c.default,Access:u.default,Discover:y.default,Authorize:A.default,BaseClient:f.default,Env:g.default},m.default.cache&&R.extend(this.featureModules,{Caching:k.default,IndexedDB:L.default,LocalStorage:O.default,InMemoryStorage:e.default,Sync:C.default}),m.default.disableFeatures.forEach(i=>{this.featureModules[i]&&delete this.featureModules[i]}),this._allLoaded=!1;for(const i in this.featureModules)this.loadFeature(i)},hasFeature(i){for(let _=this.features.length-1;_>=0;_--)if(this.features[_].name===i)return this.features[_].supported;return!1},loadFeature(i){const _=this.featureModules[i],d=!_._rs_supported||_._rs_supported();w.default(`[RemoteStorage] [FEATURE ${i}] initializing ...`),typeof d=="object"?d.then(()=>{this.featureSupported(i,!0),this.initFeature(i)},()=>{this.featureSupported(i,!1)}):typeof d=="boolean"?(this.featureSupported(i,d),d&&this.initFeature(i)):this.featureSupported(i,!1)},initFeature(i){const _=this.featureModules[i];let d;try{d=_._rs_init(this)}catch(S){return void this.featureFailed(i,S)}typeof d=="object"&&typeof d.then=="function"?d.then(()=>{this.featureInitialized(i)},S=>{this.featureFailed(i,S)}):this.featureInitialized(i)},featureFailed(i,_){w.default(`[RemoteStorage] [FEATURE ${i}] initialization failed (${_})`),this.featureDone()},featureSupported(i,_){w.default(`[RemoteStorage] [FEATURE ${i}]${_?"":"not "} supported`),_||this.featureDone()},featureInitialized(i){w.default(`[RemoteStorage] [FEATURE ${i}] initialized`),this.features.push({name:i,init:this.featureModules[i]._rs_init,supported:!0,cleanup:this.featureModules[i]._rs_cleanup}),this.featureDone()},featureDone(){this.featuresDone++,this.featuresDone===Object.keys(this.featureModules).length&&setTimeout(this.featuresLoaded.bind(this),0)},_setCachingModule(){["IndexedDB","LocalStorage","InMemoryStorage"].some(i=>{if(this.features.some(_=>_.name===i))return this.features.local=this.featureModules[i],!0})},_fireReady(){try{this.readyFired||(this._emit("ready"),this.readyFired=!0)}catch(i){console.error("'ready' failed: ",i,i.stack),this._emit("error",i)}},featuresLoaded(){w.default("[RemoteStorage] All features loaded"),this._setCachingModule(),this.local=m.default.cache&&this.features.local&&new this.features.local,this.local&&this.remote?(this._setGPD(b.default,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote),this.remote&&(this.remote.on("connected",()=>{this._fireReady(),this._emit("connected")}),this.remote.on("not-connected",()=>{this._fireReady(),this._emit("not-connected")}),this.remote.connected&&(this._fireReady(),this._emit("connected")),this.hasFeature("Authorize")||this.remote.stopWaitingForToken()),this._collectCleanupFunctions();try{this._allLoaded=!0,this._emit("features-loaded")}catch(i){R.logError(i),this._emit("error",i)}this._processPending()},_collectCleanupFunctions(){this._cleanups=[];for(let i=0;i<this.features.length;i++){const _=this.features[i].cleanup;typeof _=="function"&&this._cleanups.push(_)}}};F.exports=s},function(F,D,E){var l=this&&this.__awaiter||function(R,b,u,A){return new(u||(u=Promise))(function(y,f){function c(C){try{h(A.next(C))}catch(k){f(k)}}function p(C){try{h(A.throw(C))}catch(k){f(k)}}function h(C){var k;C.done?y(C.value):(k=C.value,k instanceof u?k:new u(function(L){L(k)})).then(c,p)}h((A=A.apply(R,b||[])).next())})};const m=(this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}})(E(1));function g(R){return this.backend==="dropbox"&&!!R.match(/^\/public\/.*[^\/]$/)}const w={get:function(R,b){if(this.local){if(b===void 0)b=typeof(u=this).remote=="object"&&u.remote.connected&&u.remote.online?2*u.getSyncInterval():(m.default("Not setting default maxAge, because remote is offline or not connected"),!1);else if(typeof b!="number"&&b!==!1)return Promise.reject("Argument 'maxAge' must be 'false' or a number");return this.local.get(R,b,this.sync.queueGetRequest.bind(this.sync))}return this.remote.get(R);var u},put:function(R,b,u){return g.bind(this)(R)?w._wrapBusyDone.call(this,this.remote.put(R,b,u)):this.local?this.local.put(R,b,u):w._wrapBusyDone.call(this,this.remote.put(R,b,u))},delete:function(R){return this.local?this.local.delete(R):w._wrapBusyDone.call(this,this.remote.delete(R))},_wrapBusyDone:function(R){return l(this,void 0,void 0,function*(){return this._emit("wire-busy"),R.then(b=>(this._emit("wire-done",{success:!0}),Promise.resolve(b)),b=>(this._emit("wire-done",{success:!1}),Promise.reject(b)))})}};F.exports=w},function(F,D,E){var l=this&&this.__awaiter||function(O,e,s,i){return new(s||(s=Promise))(function(_,d){function S(U){try{B(i.next(U))}catch(P){d(P)}}function q(U){try{B(i.throw(U))}catch(P){d(P)}}function B(U){var P;U.done?_(U.value):(P=U.value,P instanceof s?P:new s(function(N){N(P)})).then(S,q)}B((i=i.apply(O,e||[])).next())})},m=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};const g=m(E(3)),w=m(E(16)),R=m(E(2)),b=m(E(1)),u=m(E(6)),A=m(E(9)),y=m(E(4)),f=E(0);let c,p;function h(O,e,s){return{action:O,path:e,promise:s}}function C(O,e){return O.common.revision!==e&&(!O.remote||O.remote.revision!==e)}function k(O){return O.common&&O.common.revision}class L{constructor(e){this.rs=e,this._tasks={},this._running={},this._timeStarted={},this.numThreads=10,this.rs.local.onDiff(s=>{this.addTask(s),this.doTasks()}),this.rs.caching.onActivate(s=>{this.addTask(s),this.doTasks()}),this.addEvents(["done","req-done"])}now(){return new Date().getTime()}queueGetRequest(e){return new Promise((s,i)=>{this.rs.remote.connected?this.rs.remote.online?(this.addTask(e,function(){this.rs.local.get(e).then(_=>s(_))}.bind(this)),this.doTasks()):i("cannot fulfill maxAge requirement - remote is not online"):i("cannot fulfill maxAge requirement - remote is not connected")})}corruptServerItemsMap(e,s){if(typeof e!="object"||Array.isArray(e))return!0;for(const i in e){const _=e[i];if(typeof _!="object"||typeof _.ETag!="string")return!0;if(f.isFolder(i)){if(i.substring(0,i.length-1).indexOf("/")!==-1)return!0}else if(i.indexOf("/")!==-1||s&&(typeof _["Content-Type"]!="string"||typeof _["Content-Length"]!="number"))return!0}return!1}corruptItemsMap(e){if(typeof e!="object"||Array.isArray(e))return!0;for(const s in e)if(typeof e[s]!="boolean")return!0;return!1}corruptRevision(e){return typeof e!="object"||Array.isArray(e)||e.revision&&typeof e.revision!="string"||e.body&&typeof e.body!="string"&&typeof e.body!="object"||e.contentType&&typeof e.contentType!="string"||e.contentLength&&typeof e.contentLength!="number"||e.timestamp&&typeof e.timestamp!="number"||e.itemsMap&&this.corruptItemsMap(e.itemsMap)}isCorrupt(e){return typeof e!="object"||Array.isArray(e)||typeof e.path!="string"||this.corruptRevision(e.common)||e.local&&this.corruptRevision(e.local)||e.remote&&this.corruptRevision(e.remote)||e.push&&this.corruptRevision(e.push)}hasTasks(){return Object.getOwnPropertyNames(this._tasks).length>0}collectDiffTasks(){return l(this,void 0,void 0,function*(){let e=0;return this.rs.local.forAllNodes(s=>{e>100||(this.isCorrupt(s)?(b.default("[Sync] WARNING: corrupt node in local cache",s),typeof s=="object"&&s.path&&(this.addTask(s.path),e++)):(this.needsFetch(s)&&this.rs.access.checkPathPermission(s.path,"r")||f.isDocument(s.path)&&this.needsPush(s)&&this.rs.access.checkPathPermission(s.path,"rw"))&&(this.addTask(s.path),e++))}).then(()=>e).catch(s=>{throw s})})}inConflict(e){return e.local&&e.remote&&(e.remote.body!==void 0||e.remote.itemsMap)}needsRefresh(e){return!!e.common&&(!e.common.timestamp||this.now()-e.common.timestamp>g.default.syncInterval)}needsFetch(e){return!!this.inConflict(e)||!(!e.common||e.common.itemsMap!==void 0||e.common.body!==void 0)||!(!e.remote||e.remote.itemsMap!==void 0||e.remote.body!==void 0)}needsPush(e){return!this.inConflict(e)&&(!(!e.local||e.push)||void 0)}needsRemotePut(e){return e.local&&e.local.body}needsRemoteDelete(e){return e.local&&e.local.body===!1}getParentPath(e){const s=e.match(/^(.*\/)([^\/]+\/?)$/);if(s)return s[1];throw new Error('Not a valid path: "'+e+'"')}deleteChildPathsFromTasks(){for(const e in this._tasks){const s=f.pathsFromRoot(e);for(let i=1;i<s.length;i++)this._tasks[s[i]]&&(Array.isArray(this._tasks[e])&&this._tasks[e].length&&Array.prototype.push.apply(this._tasks[s[i]],this._tasks[e]),delete this._tasks[e])}}collectRefreshTasks(){return l(this,void 0,void 0,function*(){return this.rs.local.forAllNodes(e=>{let s;if(this.needsRefresh(e)){try{s=this.getParentPath(e.path)}catch{}s&&this.rs.access.checkPathPermission(s,"r")?this.addTask(s):this.rs.access.checkPathPermission(e.path,"r")&&this.addTask(e.path)}}).then(()=>this.deleteChildPathsFromTasks()).catch(e=>{throw e})})}flush(e){for(const s in e)this.rs.caching.checkPath(s)==="FLUSH"&&e[s]&&!e[s].local&&(b.default("[Sync] Flushing",s),e[s]=void 0);return e}doTask(e){return this.rs.local.getNodes([e]).then(s=>{const i=s[e];return i===void 0||function(_){return _.remote&&_.remote.revision&&!_.remote.itemsMap&&!_.remote.body}(i)?h("get",e,this.rs.remote.get(e)):this.needsRemotePut(i)?(i.push=f.deepClone(i.local),i.push.timestamp=this.now(),this.rs.local.setNodes(this.flush(s)).then(()=>{let _;return _=k(i)?{ifMatch:i.common.revision}:{ifNoneMatch:"*"},h("put",e,this.rs.remote.put(e,i.push.body,i.push.contentType,_))})):this.needsRemoteDelete(i)?(i.push={body:!1,timestamp:this.now()},this.rs.local.setNodes(this.flush(s)).then(()=>k(i)?h("delete",e,this.rs.remote.delete(e,{ifMatch:i.common.revision})):h("get",e,this.rs.remote.get(e)))):k(i)?h("get",e,this.rs.remote.get(e,{ifNoneMatch:i.common.revision})):h("get",e,this.rs.remote.get(e))})}autoMergeFolder(e){if(e.remote.itemsMap&&(e.common=e.remote,delete e.remote,e.common.itemsMap)){for(const s in e.common.itemsMap)e.local.itemsMap[s]||(e.local.itemsMap[s]=!1);f.equal(e.local.itemsMap,e.common.itemsMap)&&delete e.local}return e}autoMergeDocument(e){return function(s){return(!s.remote||!s.remote.revision||s.remote.revision===s.common.revision)&&(s.common.body===void 0&&s.remote.body===!1||s.remote.body===s.common.body&&s.remote.contentType===s.common.contentType)}(e)?delete(e=function(s){return s.remote&&s.remote.body===!1&&s.local&&s.local.body===!1&&delete s.local,s}(e)).remote:e.remote.body!==void 0&&(b.default("[Sync] Emitting keep/revert"),this.rs.local._emitChange({origin:"conflict",path:e.path,oldValue:e.local.body,newValue:e.remote.body,lastCommonValue:e.common.body,oldContentType:e.local.contentType,newContentType:e.remote.contentType,lastCommonContentType:e.common.contentType}),e.remote.body?e.common=e.remote:e.common={},delete e.remote,delete e.local),e}autoMerge(e){if(e.remote){if(e.local)return f.isFolder(e.path)?this.autoMergeFolder(e):this.autoMergeDocument(e);if(f.isFolder(e.path))e.remote.itemsMap!==void 0&&(e.common=e.remote,delete e.remote);else if(e.remote.body!==void 0){const s={origin:"remote",path:e.path,oldValue:e.common.body===!1?void 0:e.common.body,newValue:e.remote.body===!1?void 0:e.remote.body,oldContentType:e.common.contentType,newContentType:e.remote.contentType};if((s.oldValue||s.newValue)&&this.rs.local._emitChange(s),!e.remote.body)return;e.common=e.remote,delete e.remote}return e}e.common.body&&this.rs.local._emitChange({origin:"remote",path:e.path,oldValue:e.common.body,newValue:void 0,oldContentType:e.common.contentType,newContentType:void 0})}updateCommonTimestamp(e,s){return l(this,void 0,void 0,function*(){return this.rs.local.getNodes([e]).then(i=>(i[e]&&i[e].common&&i[e].common.revision===s&&(i[e].common.timestamp=this.now()),this.rs.local.setNodes(this.flush(i))))})}markChildren(e,s,i,_){return l(this,void 0,void 0,function*(){const d=[],S={},q={};for(const B in s)d.push(e+B),S[e+B]=s[B];for(const B in _)d.push(e+B);return this.rs.local.getNodes(d).then(B=>{let U,P;for(const N in B)if(P=B[N],S[N])P&&P.common?C(P,S[N].ETag)&&(i[N]=f.deepClone(P),i[N].remote={revision:S[N].ETag,timestamp:this.now()},i[N]=this.autoMerge(i[N])):(U=this.rs.caching.checkPath(N),U==="ALL"&&(i[N]={path:N,common:{timestamp:this.now()},remote:{revision:S[N].ETag,timestamp:this.now()}})),i[N]&&S[N]["Content-Type"]&&(i[N].remote.contentType=S[N]["Content-Type"]),i[N]&&S[N]["Content-Length"]&&(i[N].remote.contentLength=S[N]["Content-Length"]);else if(_[N.substring(e.length)]&&P&&P.common){if(P.common.itemsMap)for(const r in P.common.itemsMap)q[N+r]=!0;if(P.local&&P.local.itemsMap)for(const r in P.local.itemsMap)q[N+r]=!0;if(P.remote||f.isFolder(N))i[N]=void 0;else if(i[N]=this.autoMerge(P),i[N]===void 0){const r=this.getParentPath(N),o=i[r],v=N.substring(e.length);o&&o.local&&(delete o.local.itemsMap[v],f.equal(o.local.itemsMap,o.common.itemsMap)&&delete o.local)}}return this.deleteRemoteTrees(Object.keys(q),i).then(N=>this.rs.local.setNodes(this.flush(N)))})})}deleteRemoteTrees(e,s){return l(this,void 0,void 0,function*(){return e.length===0?Promise.resolve(s):this.rs.local.getNodes(e).then(i=>l(this,void 0,void 0,function*(){const _={};function d(S,q){if(S&&S.itemsMap)for(const B in S.itemsMap)_[q+B]=!0}for(const S in i){const q=i[S];q&&(f.isFolder(S)?(d(q.common,S),d(q.local,S)):q.common&&typeof q.common.body!==void 0&&(s[S]=f.deepClone(q),s[S].remote={body:!1,timestamp:this.now()},s[S]=this.autoMerge(s[S])))}return this.deleteRemoteTrees(Object.keys(_),s).then(S=>this.rs.local.setNodes(this.flush(S)))}))})}completeFetch(e,s,i,_){return l(this,void 0,void 0,function*(){let d,S;const q=f.pathsFromRoot(e);return f.isFolder(e)?d=[e]:(S=q[1],d=[e,S]),this.rs.local.getNodes(d).then(B=>{let U,P,N=B[e];const r={};function o(v){if(v&&v.itemsMap)for(U in v.itemsMap)s[U]||(r[U]=!0)}if(typeof N=="object"&&N.path===e&&typeof N.common=="object"||(N={path:e,common:{}},B[e]=N),N.remote={revision:_,timestamp:this.now()},f.isFolder(e))for(U in o(N.common),o(N.remote),N.remote.itemsMap={},s)N.remote.itemsMap[U]=!0;else N.remote.body=s,N.remote.contentType=i,P=B[S],P&&P.local&&P.local.itemsMap&&(U=e.substring(S.length),P.local.itemsMap[U]=!0,f.equal(P.local.itemsMap,P.common.itemsMap)&&delete P.local);return B[e]=this.autoMerge(N),{toBeSaved:B,missingChildren:r}})})}completePush(e,s,i,_){return l(this,void 0,void 0,function*(){return this.rs.local.getNodes([e]).then(d=>{const S=d[e];if(!S.push)throw this.stopped=!0,new Error("completePush called but no push version!");return i?(b.default("[Sync] We have a conflict"),S.remote&&S.remote.revision===_||(S.remote={revision:_||"conflict",timestamp:this.now()},delete S.push),d[e]=this.autoMerge(S)):(S.common={revision:_,timestamp:this.now()},s==="put"?(S.common.body=S.push.body,S.common.contentType=S.push.contentType,f.equal(S.local.body,S.push.body)&&S.local.contentType===S.push.contentType&&delete S.local,delete S.push):s==="delete"&&(S.local.body===!1?d[e]=void 0:delete S.push)),this.rs.local.setNodes(this.flush(d))})})}dealWithFailure(e){return l(this,void 0,void 0,function*(){return this.rs.local.getNodes([e]).then(s=>{if(s[e])return delete s[e].push,this.rs.local.setNodes(this.flush(s))})})}interpretStatus(e){const s={statusCode:e,successful:void 0,conflict:void 0,unAuth:void 0,notFound:void 0,changed:void 0,networkProblems:void 0};if(typeof e=="string"&&(e==="offline"||e==="timeout"))return s.successful=!1,s.networkProblems=!0,s;if(typeof e=="number"){const i=Math.floor(e/100);return s.successful=i===2||e===304||e===412||e===404,s.conflict=e===412,s.unAuth=e===401&&this.rs.remote.token!==u.default.IMPLIED_FAKE_TOKEN||e===402||e===403,s.notFound=e===404,s.changed=e!==304,s}}handleGetResponse(e,s,i,_,d){return l(this,void 0,void 0,function*(){return s.notFound&&(i=!!f.isFolder(e)&&{}),s.changed?this.completeFetch(e,i,_,d).then(S=>f.isFolder(e)?this.corruptServerItemsMap(i)?(b.default("[Sync] WARNING: Discarding corrupt folder description from server for "+e),!1):this.markChildren(e,i,S.toBeSaved,S.missingChildren).then(()=>!0):this.rs.local.setNodes(this.flush(S.toBeSaved)).then(()=>!0)):this.updateCommonTimestamp(e,d).then(()=>!0)})}handleResponse(e,s,i){const _=this.interpretStatus(i.statusCode);if(_.successful){if(s==="get")return this.handleGetResponse(e,_,i.body,i.contentType,i.revision);if(s==="put"||s==="delete")return this.completePush(e,s,_.conflict,i.revision).then(function(){return!0});throw new Error("cannot handle response for unknown action "+s)}{let d;return d=_.unAuth?new y.default:_.networkProblems?new A.default("Network request failed."):new Error("HTTP response code "+_.statusCode+" received."),this.dealWithFailure(e).then(()=>{throw this.rs._emit("error",d),d})}}finishTask(e){if(e.action!==void 0)return e.promise.then(s=>this.handleResponse(e.path,e.action,s),s=>(b.default("[Sync] wireclient rejects its promise!",e.path,e.action,s),this.handleResponse(e.path,e.action,{statusCode:"offline"}))).then(s=>{if(delete this._timeStarted[e.path],delete this._running[e.path],s&&this._tasks[e.path]){for(let i=0;i<this._tasks[e.path].length;i++)this._tasks[e.path][i]();delete this._tasks[e.path]}this.rs._emit("sync-req-done"),this.collectTasks(!1).then(()=>{!this.hasTasks()||this.stopped?(b.default("[Sync] Sync is done! Reschedule?",Object.getOwnPropertyNames(this._tasks).length,this.stopped),this.done||(this.done=!0,this.rs._emit("sync-done"))):setTimeout(()=>{this.doTasks()},10)})},s=>{b.default("[Sync] Error",s),delete this._timeStarted[e.path],delete this._running[e.path],this.rs._emit("sync-req-done"),this.done||(this.done=!0,this.rs._emit("sync-done"))});delete this._running[e.path]}doTasks(){let e,s,i=0;e=this.rs.remote.connected?this.rs.remote.online?this.numThreads:1:0;const _=e-Object.getOwnPropertyNames(this._running).length;if(_<=0)return!0;for(s in this._tasks)if(!this._running[s]&&(this._timeStarted[s]=this.now(),this._running[s]=this.doTask(s),this._running[s].then(this.finishTask.bind(this)),i++,i>=_))return!0;return i>=_}collectTasks(e){return l(this,void 0,void 0,function*(){return this.hasTasks()||this.stopped?Promise.resolve():this.collectDiffTasks().then(s=>s||e===!1?Promise.resolve():this.collectRefreshTasks(),function(s){throw s})})}addTask(e,s){this._tasks[e]||(this._tasks[e]=[]),typeof s=="function"&&this._tasks[e].push(s)}sync(){return this.done=!1,this.doTasks()?Promise.resolve():this.collectTasks().then(()=>{try{this.doTasks()}catch(e){b.default("[Sync] doTasks error",e)}},function(e){throw b.default("[Sync] Sync error",e),new Error("Local cache unavailable")})}static _rs_init(e){c=function(){b.default("[Sync] syncCycleCb calling syncCycle");const s=new w.default;s.isBrowser()&&function(i,_){function d(S){const q=_.getCurrentSyncInterval();g.default.isBackground=!S;const B=_.getCurrentSyncInterval();_._emit("sync-interval-change",{oldValue:q,newValue:B})}i.on("background",()=>d(!1)),i.on("foreground",()=>d(!0))}(s,e),e.sync||(e.sync=new L(e),e.syncStopped&&(b.default("[Sync] Instantiating sync stopped"),e.sync.stopped=!0,delete e.syncStopped)),b.default("[Sync] syncCycleCb calling syncCycle"),e.syncCycle()},p=function(){e.removeEventListener("connected",p),e.startSync()},e.on("ready",c),e.on("connected",p)}static _rs_cleanup(e){e.stopSync(),e.removeEventListener("ready",c),e.removeEventListener("connected",p),e.sync=void 0,delete e.sync}}f.applyMixins(L,[R.default]),F.exports=L},function(F,D,E){(function(l){var m=this&&this.__awaiter||function(f,c,p,h){return new(p||(p=Promise))(function(C,k){function L(s){try{e(h.next(s))}catch(i){k(i)}}function O(s){try{e(h.throw(s))}catch(i){k(i)}}function e(s){var i;s.done?C(s.value):(i=s.value,i instanceof p?i:new p(function(_){_(i)})).then(L,O)}e((h=h.apply(f,c||[])).next())})},g=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};const w=g(E(2)),R=g(E(10)),b=g(E(1)),u=E(0);let A;class y extends R.default{constructor(c){super(),this.addEvents(["change","local-events-done"]),this.db=c||A,this.db?(this.getsRunning=0,this.putsRunning=0,this.changesQueued={},this.changesRunning={},this.commitSlownessWarning=null):b.default("[IndexedDB] Failed to open DB")}getNodes(c){return m(this,void 0,void 0,function*(){const p=[],h={};for(let C=0,k=c.length;C<k;C++)this.changesQueued[c[C]]!==void 0?h[c[C]]=u.deepClone(this.changesQueued[c[C]]||void 0):this.changesRunning[c[C]]!==void 0?h[c[C]]=u.deepClone(this.changesRunning[c[C]]||void 0):p.push(c[C]);return p.length>0?this.getNodesFromDb(p).then(function(C){for(const k in h)C[k]=h[k];return C}):Promise.resolve(h)})}setNodes(c){return m(this,void 0,void 0,function*(){for(const p in c)this.changesQueued[p]=c[p]||!1;return this.maybeFlush(),Promise.resolve()})}maybeFlush(){this.putsRunning===0?this.flushChangesQueued():this.commitSlownessWarning||(this.commitSlownessWarning=l.setInterval(function(){console.warn("WARNING: waited more than 10 seconds for previous commit to finish")},1e4))}flushChangesQueued(){this.commitSlownessWarning&&(clearInterval(this.commitSlownessWarning),this.commitSlownessWarning=null),Object.keys(this.changesQueued).length>0&&(this.changesRunning=this.changesQueued,this.changesQueued={},this.setNodesInDb(this.changesRunning).then(this.flushChangesQueued.bind(this)))}getNodesFromDb(c){return new Promise((p,h)=>{const C=this.db.transaction(["nodes"],"readonly"),k=C.objectStore("nodes"),L={};this.getsRunning++,c.map(O=>{k.get(O).onsuccess=e=>{L[O]=e.target.result}}),C.oncomplete=()=>{p(L),this.getsRunning--},C.onerror=C.onabort=()=>{h("get transaction error/abort"),this.getsRunning--}})}setNodesInDb(c){return m(this,void 0,void 0,function*(){return new Promise((p,h)=>{const C=this.db.transaction(["nodes"],"readwrite"),k=C.objectStore("nodes"),L=new Date().getTime();this.putsRunning++,b.default("[IndexedDB] Starting put",c,this.putsRunning);for(const O in c){const e=c[O];if(typeof e=="object")try{k.put(e)}catch(s){throw b.default("[IndexedDB] Error while putting",e,s),s}else try{k.delete(O)}catch(s){throw b.default("[IndexedDB] Error while removing",k,e,s),s}}C.oncomplete=()=>{this.putsRunning--,b.default("[IndexedDB] Finished put",c,this.putsRunning,new Date().getTime()-L+"ms"),p()},C.onerror=()=>{this.putsRunning--,h("transaction error")},C.onabort=()=>{h("transaction abort"),this.putsRunning--}})})}reset(c){const p=this.db.name;this.db.close(),y.clean(this.db.name,()=>{y.open(p,(h,C)=>{h?b.default("[IndexedDB] Error while resetting local storage",h):this.db=C,typeof c=="function"&&c(self)})})}forAllNodes(c){return m(this,void 0,void 0,function*(){return new Promise(p=>{this.db.transaction(["nodes"],"readonly").objectStore("nodes").openCursor().onsuccess=h=>{const C=h.target.result;C?(c(this.migrate(C.value)),C.continue()):p()}})})}closeDB(){this.putsRunning===0?this.db.close():setTimeout(this.closeDB.bind(this),100)}static open(c,p){const h=setTimeout(function(){p("timeout trying to open db")},1e4);try{const C=indexedDB.open(c,2);C.onerror=function(){b.default("[IndexedDB] Opening DB failed",C),clearTimeout(h),p(C.error)},C.onupgradeneeded=function(k){const L=C.result;b.default("[IndexedDB] Upgrade: from ",k.oldVersion," to ",k.newVersion),k.oldVersion!==1&&(b.default("[IndexedDB] Creating object store: nodes"),L.createObjectStore("nodes",{keyPath:"path"})),b.default("[IndexedDB] Creating object store: changes"),L.createObjectStore("changes",{keyPath:"path"})},C.onsuccess=function(){clearTimeout(h);const k=C.result;if(!k.objectStoreNames.contains("nodes")||!k.objectStoreNames.contains("changes"))return b.default("[IndexedDB] Missing object store. Resetting the database."),void y.clean(c,function(){y.open(c,p)});p(null,C.result)}}catch(C){b.default("[IndexedDB] Failed to open database: "+C),b.default("[IndexedDB] Resetting database and trying again."),clearTimeout(h),y.clean(c,function(){y.open(c,p)})}}static clean(c,p){const h=indexedDB.deleteDatabase(c);h.onsuccess=function(){b.default("[IndexedDB] Done removing DB"),p()},h.onerror=h.onabort=function(C){console.error('Failed to remove database "'+c+'"',C)}}static _rs_init(c){return new Promise((p,h)=>{y.open("remotestorage",function(C,k){C?h(C):(A=k,k.onerror=()=>{c._emit("error",C)},p())})})}static _rs_supported(){return new Promise((c,p)=>{const h=u.getGlobalContext();let C=!1;if(typeof navigator!="undefined"&&navigator.userAgent.match(/Android (2|3|4\.[0-3])/)&&(navigator.userAgent.match(/Chrome|Firefox/)||(C=!0)),"indexedDB"in h&&!C)try{const k=indexedDB.open("rs-check");k.onerror=function(){p()},k.onsuccess=function(){k.result.close(),indexedDB.deleteDatabase("rs-check"),c()}}catch{p()}else p()})}static _rs_cleanup(c){return new Promise(p=>{c.local&&c.local.closeDB(),y.clean("remotestorage",p)})}diffHandler(){}}u.applyMixins(y,[w.default]),F.exports=y}).call(this,E(5))},function(F,D,E){var l=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};const m=l(E(10)),g=l(E(2)),w=l(E(1)),R=E(0),b="remotestorage:cache:nodes:";function u(y){return y.substr(0,b.length)===b||y.substr(0,28)==="remotestorage:cache:changes:"}class A extends m.default{constructor(){super(),this.addEvents(["change","local-events-done"])}diffHandler(...f){}getNodes(f){const c={};for(let p=0,h=f.length;p<h;p++)try{c[f[p]]=JSON.parse(localStorage[b+f[p]])}catch{c[f[p]]=void 0}return Promise.resolve(c)}setNodes(f){for(const c in f)localStorage[b+c]=JSON.stringify(f[c]);return Promise.resolve()}forAllNodes(f){let c;for(let p=0,h=localStorage.length;p<h;p++)if(localStorage.key(p).substr(0,b.length)===b){try{c=this.migrate(JSON.parse(localStorage[localStorage.key(p)]))}catch{c=void 0}c&&f(c)}return Promise.resolve()}static _rs_init(){}static _rs_supported(){return R.localStorageAvailable()}static _rs_cleanup(){const f=[];for(let c=0,p=localStorage.length;c<p;c++){const h=localStorage.key(c);u(h)&&f.push(h)}f.forEach(c=>{w.default("[LocalStorage] Removing",c),delete localStorage[c]})}}R.applyMixins(A,[g.default]),F.exports=A},function(F,D,E){var l=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};const m=l(E(2)),g=l(E(10)),w=E(0);class R extends g.default{constructor(){super(),this._storage={},this.addEvents(["change","local-events-done"])}getNodes(u){const A={};for(let y=0,f=u.length;y<f;y++)A[u[y]]=this._storage[u[y]];return Promise.resolve(A)}setNodes(u){for(const A in u)u[A]===void 0?delete this._storage[A]:this._storage[A]=u[A];return Promise.resolve()}forAllNodes(u){for(const A in this._storage)u(this.migrate(this._storage[A]));return Promise.resolve()}diffHandler(){}static _rs_init(){}static _rs_supported(){return!0}static _rs_cleanup(){}}w.applyMixins(R,[m.default]),F.exports=R}])})})(xt);var te=Zt(xt.exports);const Nt=new te;Nt.setApiKeys({dropbox:Wt,googledrive:Xt});function ee(Z){let V;return{c(){V=lt("div"),this.h()},l(F){V=ht(F,"DIV",{id:!0}),at(V).forEach(ot),this.h()},h(){nt(V,"id",Z[0])},m(F,D){pt(F,V,D)},p:ft,i:ft,o:ft,d(F){F&&ot(V)}}}let re=0;function ne(Z,V,F){let{element:D=void 0}=V,{widget:E=void 0}=V;const l=`remote-storage-widget-${++re}`;return Ut(()=>{$t(()=>import("./widget-bc58238e.js").then(function(m){return m.w}),[]).then(({default:m})=>{const g=new m(Nt);g.attach(l),function w(){g.rsWidget?(F(2,E=g),F(1,D=g.rsWidget)):setTimeout(w,1e3)}()})}),Z.$$set=m=>{"element"in m&&F(1,D=m.element),"widget"in m&&F(2,E=m.widget)},[l,D,E]}class oe extends Et{constructor(V){super(),Tt(this,V,ne,ee,At,{element:1,widget:2})}}const jt=Kt([]),ie=jt;function se(Z){jt.update(V=>{const F=V.findIndex(D=>D.id===Z);return F===-1||V.splice(F,1),V})}function Mt(Z,V,F){const D=Z.slice();return D[2]=V[F],D}function It(Z){let V,F,D,E;return{c(){V=lt("div"),F=_t("svg"),D=_t("path"),E=_t("path"),this.h()},l(l){V=ht(l,"DIV",{class:!0});var m=at(V);F=bt(m,"svg",{width:!0,height:!0,viewBox:!0,class:!0,fill:!0,xmlns:!0});var g=at(F);D=bt(g,"path",{"fill-rule":!0,d:!0}),at(D).forEach(ot),E=bt(g,"path",{"fill-rule":!0,d:!0}),at(E).forEach(ot),g.forEach(ot),m.forEach(ot),this.h()},h(){nt(D,"fill-rule","evenodd"),nt(D,"d","M11.854 4.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708l7-7a.5.5 0 0 1 .708 0z"),nt(E,"fill-rule","evenodd"),nt(E,"d","M4.146 4.146a.5.5 0 0 0 0 .708l7 7a.5.5 0 0 0 .708-.708l-7-7a.5.5 0 0 0-.708 0z"),nt(F,"width","1.8em"),nt(F,"height","1.8em"),nt(F,"viewBox","0 0 16 16"),nt(F,"class","bi bi-x"),nt(F,"fill","currentColor"),nt(F,"xmlns","http://www.w3.org/2000/svg"),nt(V,"class","text-red-500 rounded-full bg-white mr-3")},m(l,m){pt(l,V,m),ut(V,F),ut(F,D),ut(F,E)},d(l){l&&ot(V)}}}function Ct(Z,V){let F,D,E,l=V[2].message+"",m,g,w,R,b=V[2].type==="error"&&It();function u(){return V[1](V[2])}return{key:Z,first:null,c(){F=lt("div"),b&&b.c(),D=gt(),E=lt("div"),m=Dt(l),g=gt(),this.h()},l(A){F=ht(A,"DIV",{class:!0});var y=at(F);b&&b.l(y),D=yt(y),E=ht(y,"DIV",{class:!0});var f=at(E);m=Ft(f,l),f.forEach(ot),g=yt(y),y.forEach(ot),this.h()},h(){nt(E,"class","text-white max-w-xs "),nt(F,"class","flex items-center py-2 px-3 shadow-md mb-2 cursor-pointer"),mt(F,"bg-green-500",V[2].type==="success"),mt(F,"bg-red-500",V[2].type==="error"),this.first=F},m(A,y){pt(A,F,y),b&&b.m(F,null),ut(F,D),ut(F,E),ut(E,m),ut(F,g),w||(R=Lt(F,"click",u),w=!0)},p(A,y){V=A,V[2].type==="error"?b||(b=It(),b.c(),b.m(F,D)):b&&(b.d(1),b=null),y&1&&l!==(l=V[2].message+"")&&Bt(m,l),y&1&&mt(F,"bg-green-500",V[2].type==="success"),y&1&&mt(F,"bg-red-500",V[2].type==="error")},d(A){A&&ot(F),b&&b.d(),w=!1,R()}}}function ae(Z){let V,F=[],D=new Map,E=Z[0];const l=m=>m[2].id.toString();for(let m=0;m<E.length;m+=1){let g=Mt(Z,E,m),w=l(g);D.set(w,F[m]=Ct(w,g))}return{c(){V=lt("div");for(let m=0;m<F.length;m+=1)F[m].c();this.h()},l(m){V=ht(m,"DIV",{class:!0});var g=at(V);for(let w=0;w<F.length;w+=1)F[w].l(g);g.forEach(ot),this.h()},h(){nt(V,"class","p-2 absolute bottom-0 w-full")},m(m,g){pt(m,V,g);for(let w=0;w<F.length;w+=1)F[w].m(V,null)},p(m,[g]){g&1&&(E=m[0],F=qt(F,g,l,1,m,E,D,V,Gt,Ct,null,Mt))},i:ft,o:ft,d(m){m&&ot(V);for(let g=0;g<F.length;g+=1)F[g].d()}}}function ue(Z,V,F){let D;return Jt(Z,ie,l=>F(0,D=l)),[D,l=>se(l.id)]}class ce extends Et{constructor(V){super(),Tt(this,V,ue,ae,At,{})}}function le(Z){let V,F,D,E,l,m,g,w;const R=Z[1].default,b=Ht(R,Z,Z[0],null);return l=new oe({}),g=new ce({}),{c(){V=lt("div"),F=lt("div"),b&&b.c(),D=gt(),E=lt("div"),Rt(l.$$.fragment),m=gt(),Rt(g.$$.fragment),this.h()},l(u){V=ht(u,"DIV",{class:!0});var A=at(V);F=ht(A,"DIV",{class:!0});var y=at(F);b&&b.l(y),y.forEach(ot),D=yt(A),E=ht(A,"DIV",{class:!0});var f=at(E);St(l.$$.fragment,f),f.forEach(ot),m=yt(A),St(g.$$.fragment,A),A.forEach(ot),this.h()},h(){nt(F,"class","flex flex-col flex-grow"),nt(E,"class","absolute left-0 bottom-0 z-20"),nt(V,"class","flex w-full h-full")},m(u,A){pt(u,V,A),ut(V,F),b&&b.m(F,null),ut(V,D),ut(V,E),kt(l,E,null),ut(V,m),kt(g,V,null),w=!0},p(u,[A]){b&&b.p&&(!w||A&1)&&Yt(b,R,u,u[0],w?zt(R,u[0],A,null):Vt(u[0]),null)},i(u){w||(wt(b,u),wt(l.$$.fragment,u),wt(g.$$.fragment,u),w=!0)},o(u){Pt(b,u),Pt(l.$$.fragment,u),Pt(g.$$.fragment,u),w=!1},d(u){u&&ot(V),b&&b.d(u),Ot(l),Ot(g)}}}function he(Z,V,F){let{$$slots:D={},$$scope:E}=V;return Z.$$set=l=>{"$$scope"in l&&F(0,E=l.$$scope)},[E,D]}class pe extends Et{constructor(V){super(),Tt(this,V,he,le,At,{})}}export{pe as L,Nt as r};
